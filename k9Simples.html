<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- February 15, 2021

Copyright (C) 2020 John Estrada -->
<!-- Created by GNU Texinfo 6.7, http://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Shakti (k9) tutorial</title>

<meta name="description" content="Shakti (k9) tutorial">
<meta name="keywords" content="Shakti (k9) tutorial">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="texi2any">
<link href="#Top" rel="start" title="Top">
<style type="text/css">
<!--
/* spacing */


a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
.cartouche{
    border: none;
    background: lightgrey;
}

table, th, td{
  table-layout: auto;
  border-collapse: collapse;
  border: 1px solid blue;
  font-family: monospace; 
}

th, td {
  padding: 5px;     
  font-family: monospace; 
}

tr:nth-child(1) {
/*    background-color:lightsteelblue; // Replace it with your desired color */
}

.menu{
    border: none;
}

table.menu td{ 
    padding: 1px;
    border: none;
    font-family: sansserif;
}

table.menu th{ 
    padding: 1px;
    border: none;
    font-family: sansserif;
}




-->
</style>


</head>

<body lang="en">
<h1 class="settitle" align="center">Shakti (k9) tutorial</h1>



<span id="Top"></span><div class="header">
<p>
Next: <a href="#Introduction" accesskey="n" rel="next">Introduction</a> &nbsp; </p>
</div>
<span id="k9_003a-Manual"></span><h1 class="top">k9: Manual</h1>
<p>This manual is for Shakti (k9) build 2020.12.04.<br>
</p>
<p>The Shakti programming language is the work of Arthur Whitney and the team at Shakti.  The language comes from a lineage of similar languages going back to APL.  It&rsquo;s also known as k9 given the similarities to k, k2, ..., k6, k7 and the fact that Arthur also wrote those.  k9 is still under development so expect a bit of syntax change and likely even more improvements.
</p>
<p>Learning k9 means code like <code>{x@(!#x)+\!#y}</code> is clear and actually prefered to something much longer and verbose.  You&rsquo;ll have to go a bit down the rabbit hole before it starts to come together but once it does you&rsquo;ll probably be happy you gave it a chance and end up learning a few things.  You&rsquo;ll understand how fast k9 can be in processing and analyzing data and how terse code is less likely to contain errors.  Unfortunately you will be less likely to be content using more bloated and slow frameworks.  
</p>
<p>Alas this manual is not as elegant as the k9 language in that the text version of this document is almost as big as the binary of the language.  
</p>
<p>The built-in reference screen (<code>\</code>) containing all the k9 commands.
</p>
<p><tt>*ffi:&nbsp;a:&quot;./a.so&quot;5:`f!&quot;ii&quot;;a.f[2;3]&nbsp;/&nbsp;int&nbsp;f(int&nbsp;i,int&nbsp;j){return&nbsp;i+j;}</tt><br>
<tt>*k/c:&nbsp;b:&quot;./b.so&quot;5:`f!2&nbsp;&nbsp;&nbsp;;b.f[2;3]&nbsp;/&nbsp;K&nbsp;f(K&nbsp;x,K&nbsp;y){return&nbsp;ki(xi+yi);}</tt><br>
<tt>[python:&nbsp;&nbsp;&nbsp;import&nbsp;k;k.k('+',2,3)]</tt><br>
<tt>[nodejs:&nbsp;require('k').k('+',2,3)]</tt><br>
<tt>limit:&nbsp;#(4billion)&nbsp;name8&nbsp;code(param8&nbsp;local8&nbsp;global32&nbsp;const128)</tt><br>
<tt></tt><br>
<tt><a href="#Verb">verb</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Adverb">adverb</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Noun">noun</a></tt><br>
<tt>:&nbsp;x&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f'&nbsp;<a href="#each">each</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g'&nbsp;<a href="#each">each</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="#char">char</a>&nbsp;&quot;&nbsp;ab&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\l&nbsp;a.k</tt><br>
<tt>+&nbsp;<a href="#flip">flip</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#plus">plus</a>&nbsp;&nbsp;&nbsp;&nbsp;[x]f/&nbsp;<a href="#cover">over</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c/&nbsp;<a href="#join">join</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="#name">name</a>&nbsp;``ab&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\t:n&nbsp;x</tt><br>
<tt>-&nbsp;<a href="#minus">minus</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#minus">minus</a>&nbsp;&nbsp;&nbsp;[x]f\&nbsp;<a href="#cscan">scan</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c\&nbsp;splt&nbsp;&nbsp;&nbsp;&nbsp;<a href="#int">int</a>&nbsp;&nbsp;0N&nbsp;2&nbsp;3&nbsp;0W&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\u:n&nbsp;x</tt><br>
<tt>*&nbsp;<a href="#first">first</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#times">times</a>&nbsp;&nbsp;&nbsp;[y]f':<a href="#eachp">eachp</a>rior&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#flt">flt</a>&nbsp;&nbsp;0n&nbsp;2&nbsp;3.4&nbsp;0w&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\v</tt><br>
<tt>%&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#divide">divide</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f/:<a href="#eachr">eachr</a>ight&nbsp;g/:<a href="#cover">over</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="#date">date</a>&nbsp;2021.01.23&nbsp;&nbsp;&nbsp;.z.d</tt><br>
<tt>&amp;&nbsp;<a href="#where">where</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#min_002fand">min/and</a>&nbsp;&nbsp;&nbsp;&nbsp;f\:<a href="#eachl">eachl</a>eft&nbsp;&nbsp;g\:<a href="#cscan">scan</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="#time">time</a>&nbsp;12:34:56.789&nbsp;.z.t</tt><br>
<tt>|&nbsp;<a href="#reverse">reverse</a>&nbsp;&nbsp;&nbsp;<a href="#max_002for">max/or</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</tt><br>
<tt>&lt;&nbsp;<a href="#asc">asc</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#less">less</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#I_002fO">i/o</a>&nbsp;(*enterprise)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;class&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\f</tt><br>
<tt>&gt;&nbsp;<a href="#desc">desc</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#more">more</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0:&nbsp;<a href="#r-line">r</a>/<a href="#w-line">w</a>&nbsp;line&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#List">list</a>&nbsp;l:(2;3.4;`c)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\fl&nbsp;x</tt><br>
<tt>=&nbsp;<a href="#group">group</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#equal">equal</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1:&nbsp;<a href="#r-byte">r</a>/<a href="#w-byte">w</a>&nbsp;char&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Dictionary">dict</a>&nbsp;d:[n:`b;i:2]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\fc&nbsp;x&nbsp;&nbsp;&nbsp;</tt><br>
<tt>~&nbsp;<a href="#not">not</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#match">match</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*2:&nbsp;<a href="#r-data">r</a>/<a href="#w-data">w</a>&nbsp;data&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#User-Functions">func</a>&nbsp;f:{[a;b]a+b}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\fs&nbsp;x</tt><br>
<tt>!&nbsp;<a href="#key">key</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#key">key</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*3:&nbsp;<a href="#k_002dipc-set">k-ipc set</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Expression">expr</a>&nbsp;e::a+b&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\cd&nbsp;[d]</tt><br>
<tt>,&nbsp;<a href="#enlist">enlist</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="#cat">cat</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*4:&nbsp;<a href="#https-get">https get</a></tt><br>
<tt>^&nbsp;<a href="#sort">sort</a>&nbsp;&nbsp;&nbsp;[f]<a href="#cut">cut</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*5:&nbsp;<a href="#ffi_002fpy_002fjs_002f_002e_002e">ffi/py/js/..</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Tables">table</a>&nbsp;t:[[]n:`b`c;i:2&nbsp;3]</tt><br>
<tt>#&nbsp;<a href="#count">count</a>&nbsp;&nbsp;[f]<a href="#take">take</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#utable">utable</a>&nbsp;u:&nbsp;[[n:`b`c]i:2&nbsp;3]</tt><br>
<tt>_&nbsp;<a href="#floor">floor</a>&nbsp;&nbsp;[f]<a href="#drop">drop</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</tt><br>
<tt>$&nbsp;<a href="#string">string</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="#parse">parse</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$[b;t;f]&nbsp;<a href="#cond">cond</a></tt><br>
<tt>?&nbsp;<a href="#unique">unique</a>&nbsp;[n]<a href="#find">find</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</tt><br>
<tt>@&nbsp;<a href="#type">type</a>&nbsp;&nbsp;&nbsp;[n]<a href="#at">at</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@[x;i;f[;y]]&nbsp;<a href="#amend">amend</a></tt><br>
<tt>.&nbsp;<a href="#value">value</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#dot">dot</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.[x;i;f[;y]]&nbsp;<a href="#dmend">dmend</a></tt><br>
<tt></tt><br>
<tt><a href="#read-json">`js?</a><a href="#write-json">`js&nbsp;</a>d:[d:.z.d;t:.z.t;n:`ab;i:23;f:4.5];<a href="#read-csv">`csv?</a><a href="#write-csv">`csv&nbsp;</a>t:2#,d</tt><br>
<tt>{<a href="#select">select</a>|<a href="#update">update</a>}&nbsp;<a href="#A">A</a>&nbsp;by&nbsp;B&nbsp;from&nbsp;T&nbsp;where&nbsp;C;&nbsp;<a href="#delete">delete</a>&nbsp;from&nbsp;T&nbsp;where&nbsp;C</tt><br>
<tt><a href="#count">count</a>&nbsp;<a href="#Hfirst">first</a>&nbsp;<a href="#Hlast">last</a>&nbsp;<a href="#Hmin">min</a>&nbsp;<a href="#Hmax">max</a>&nbsp;sum&nbsp;<a href="#dot">dot</a>&nbsp;avg&nbsp;var&nbsp;[dev&nbsp;med&nbsp;<a href="#mod">mod</a>e&nbsp;<a href="#count">count</a>d&nbsp;..]</tt><br>
<tt><a href="#sqrt">sqrt</a>&nbsp;<a href="#sqr">sqr</a>&nbsp;<a href="#exp">exp</a>&nbsp;<a href="#log">log</a>&nbsp;<a href="#sin">sin</a>&nbsp;<a href="#cos">cos</a>&nbsp;<a href="#div">div</a>&nbsp;<a href="#mod">mod</a>&nbsp;<a href="#bar">bar</a>&nbsp;<a href="#in">in</a>&nbsp;<a href="#bin">bin</a></tt><br>
<tt>\\&nbsp;exit&nbsp;&nbsp;/comment&nbsp;\trace&nbsp;[:return&nbsp;'signal&nbsp;if&nbsp;do&nbsp;while]</tt><br>
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top">&bull; <a href="#Introduction" accesskey="1">Introduction</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">An introduction to shakti/k9, a novel computer language for data analysis
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Verb" accesskey="2">Verb</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">Elementary functions
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Adverb" accesskey="3">Adverb</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">Function modifiers
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Noun" accesskey="4">Noun</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">Basic data types
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#List" accesskey="5">List</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">Uniform and non-uniform lists
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Dictionary" accesskey="6">Dictionary</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">Dictionaries and functions for dictionaries
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#User-Functions" accesskey="7">User Functions</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">User-defined functions
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Expression" accesskey="8">Expression</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">Expression Evaluation
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Named-Functions" accesskey="9">Named Functions</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">Named functions
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Knit-Functions">Knit Functions</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">Function to modify lists and dictionaries
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#I_002fO">I/O</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">Input and output
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Tables">Tables</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">Tables to store data
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#kSQL">kSQL</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">kSQL to query tables
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#System">System</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">System functions and measurements
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Control-Flow">Control Flow</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">If/Do/While Statements 
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Temporal-Functions">Temporal Functions</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">Functions for date and time
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Errors">Errors</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">Error messages
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Examples">Examples</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">A Short Finance Example + Practice Decomposing Other People&rsquo;s Code
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Benchmark">Benchmark</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">Learn how fast this language is
</td></tr>
<tr><td align="left" valign="top">&bull; <a href="#Conclusion">Conclusion</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">Conclusion
</td></tr>
</table>

<hr>
<span id="Introduction"></span><div class="header">
<p>
Next: <a href="#Verb" accesskey="n" rel="next">Verb</a>, Previous: <a href="#Top" accesskey="p" rel="prev">Top</a>, Up: <a href="#Top" accesskey="u" rel="up">Top</a> &nbsp; </p>
</div>
<span id="Introduction-1"></span><h2 class="chapter">1 Introduction</h2>
<p>The k9 programming language is designed primarily for the analysis of data.  It may surprise new users with two rather different paradigms, (1) fast data analysis and (2) concise syntax.  After you become familiar with the languages, these features will both seem normal and going back to slow and verbose programming will be surprisingly difficult.
</p>
<span id="Going-fast"></span><h3 class="section">1.1 Going fast</h3>
<p>Imagine you have a small, on-disk, 100 million row database containing a time-series with two float values at each time.  Additionally this data could be split in three different tables covering different measurements.  Here&rsquo;s how fast k9 can read in the data from disk and compute a statistic, average difference over each table, which uses each and every row.
</p>
<div class="example">
<pre class="example"> bash-3.2$ ./k
 2020.xx.xx 17GB 4core (c) shakti
 \t q:2:`q;{select s:avg a-b from x}'q[!q]
495
</pre></div>

<p>That&rsquo;s 495 ms to read the data in from disk and compute over all the 100 million values.  The data read is the biggest bit.  If the data were already in memory then the computation would be  faster:
</p>
<div class="example">
<pre class="example"> \t {select s:avg a-b from x}'q[!q]
230
</pre></div>

<p>230 ms, not bad for 100 million calculations.
</p>
<p>The code to generate the on-disk database is presented below.  Speed of course will depend on your hardware so times will vary.
</p>
<div class="example">
<pre class="example"> nf:d+*|d:(|-d),d:683 954 997 1000;
 T:^`t rand[;_8.64e7]@
 B:100++\1e-2*-3+nf bin/:rand[;*|nf]@
 S:rand[;1e-2*2,2,8#1]@
 L:{select t,b,a:b+s from +`t`b`s!(T;B;S)@'x}
 q:`eurusd`usdjpy`usdchf!L'_60e6 20e6 20e6
 `q 2:q
</pre></div>

<span id="Going-concise"></span><h3 class="section">1.2 Going concise</h3>

<p>The k9 language is more closely related to mathematics syntax than most programming lanauges.  It requires the developer to learn to &ldquo;speak&rdquo; k9 but once that happens most find an ability to speak quicker and more accurately in k9 than in other languages.  At this point an example might help.
</p>
<p>In mathematics, &ldquo;3+2&rdquo; is read as &ldquo;3 plus 2&rdquo; as you learn at an early age that &ldquo;+&rdquo; is the &ldquo;plus&rdquo; sign.  For trival operations like arithmetic most programming languages use symbols also.  When moving beyond arithmetic, most programming lanauges switch to words while k9 remains with symbols.  As an example, to determine the distinct values of a list most programming languages might use a syntax like <code>distinct()</code> while k9 uses <code>?</code>.  This requires the developer to learn how to say a number of symbols but once that happens it results in much shorter code that is quicker to write, easier to inspect, and easier to maintain.  
</p>
<p>This should not be surprising. In arithmetic, which do you find easier to answer?<br><br>
Math with text<br>
Three plus two times open parenthesis six plus fourteen close parenthesis<br><br>
Math with symbols<br>
3+2*(6+14)<br>
</p>
<p>In code, which will you eventually find easier to understand?<br><br>
Code with text<br>
x = (0,12,3,4,1,17,-5,0,3,11);y=5;<br>
distinct_x = distinct(x);<br>
gt_distinct_x = [i for i in j if i &gt;= y];<br><br>
Code with symbols<br>
x:(0,12,3,4,1,17,-5,0,3,11);y:5;<br>
z@&amp;y&lt;z:?x<br>
</p>
<p>If you&rsquo;re new to k9 then you&rsquo;ll  appreciate that symbols are shorter but look like line noise.  That&rsquo;s true but so did arithetic until you learned the basics.
</p>
<p>When you first learned arithmetic you likely didn&rsquo;t have a choice.  Now you have a choice whether or not you want to learn k9.  If you give it a try, then  you&rsquo;ll get it quickly and move onto the power phase fast enough that you&rsquo;ll be happy you gave it a chance.
</p>
<span id="Get-k9_002e"></span><h3 class="section">1.3 Get k9.</h3>

<p><a href="https://shakti.sh">https://shakti.sh</a>
</p>
<p>You will find the Linux version in the linux directory and the MacOS version under macos.  Once you download the MacOS version you&rsquo;ll have to change its file permissions to allow it to execute.
</p>
<div class="example">
<pre class="example">&nbsp;chomd u+x k
</pre></div>

<p>Again on the mac if you then attempt to run this file you likely won&rsquo;t succeed due to MacOS security.  You&rsquo;ll need to go to &ldquo;System Preferences...&rdquo; and then &ldquo;Security and Privacy&rdquo; and select to allow this binary to run.  (You&rsquo;ll have to have tried and failed to have it appear here automatically.)
</p>
<span id="Help-_002f-Info-Card"></span><h3 class="section">1.4 Help / Info Card</h3>
<p>Typing <code>\</code> in a terminal window gives you a concise overview of the language.  This document aims to provide details to beginning user where the help screen is a bit too terse.  Some commands are not yet complete and thus marked with an asterisk, eg. *update A by B from T where C.
</p>
<div class="format">
<pre class="verbatim">*ffi: a:&quot;./a.so&quot;5:`f!&quot;ii&quot;;a.f[2;3] / int f(int i,int j){return i+j;}
*k/c: b:&quot;./b.so&quot;5:`f!2   ;b.f[2;3] / K f(K x,K y){return ki(xi+yi);}
[python:   import k;k.k('+',2,3)]
[nodejs: require('k').k('+',2,3)]
limit: #(4billion) name8 code(param8 local8 global32 const128)

verb                   adverb                  noun
: x         y          f' each      g' each    char &quot; ab&quot;              \l a.k
+ flip      plus    [x]f/ over      c/ join    name ``ab               \t:n x
- minus     minus   [x]f\ scan      c\ splt    int  0N 2 3 0W          \u:n x
* first     times   [y]f':eachprior            flt  0n 2 3.4 0w        \v
%           divide     f/:eachright g/:over    date 2021.01.23   .z.d
&amp; where     min/and    f\:eachleft  g\:scan    time 12:34:56.789 .z.t
| reverse   max/or     
&lt; asc       less       i/o (*enterprise)       class                   \f
&gt; desc      more       0: r/w line             list l:(2;3.4;`c)       \fl x
= group     equal      1: r/w char             dict d:[n:`b;i:2]       \fc x   
~ not       match     *2: r/w data             func f:{[a;b]a+b}       \fs x
! key       key       *3: k-ipc set            expr e::a+b             \cd [d]
, enlist    cat       *4: https get
^ sort   [f]cut       *5: ffi/py/js/..         table t:[[]n:`b`c;i:2 3]
# count  [f]take                              utable u: [[n:`b`c]i:2 3]
_ floor  [f]drop                       
$ string    parse      $[b;t;f] cond
? unique [n]find                             
@ type   [n]at         @[x;i;f[;y]] amend
. value     dot        .[x;i;f[;y]] dmend

`js?`js d:[d:.z.d;t:.z.t;n:`ab;i:23;f:4.5];`csv?`csv t:2#,d
{select|update} A by B from T where C; delete from T where C
count first last min max sum dot avg var [dev med mode countd ..]
sqrt sqr exp log sin cos div mod bar in bin
\\ exit  /comment \trace [:return 'signal if do while]</pre></div>

<span id="rlwrap"></span><h3 class="section">1.5 rlwrap</h3>
<p>Although you only need the <samp>k</samp> binary to run k9 most will also install rlwrap, if not already installed, in order to get command history in a terminal window.  rlwrap is &ldquo;Readline wrapper: adds readline support to tools that lack it&rdquo; and allows one to arrow up to go through the command buffer history.
</p>
<p>In order to start k9 you should either run <samp>k</samp> or <samp>rlwrap k</samp> to get started.  Here I will show both options but one should run as desired.  In this document lines with input are shown with a leading space and output will be without.  In the examples below the user starts a terminal window in the directory with the <samp>k</samp> binary file.  Then the users enters <kbd>rlwrap ./k <span class="key">RET</span></kbd>.  k9 starts and displays the date of the build, (c), and shakti and then listens to user input.  In this example I have entered the command to exit k9, <kbd>\\</kbd>.  Then I start k9 again without rlwrap and again exit the session.
</p>
<div class="example">
<pre class="example"> rlwrap ./k
Sep 13 2020 16GB (c) shakti
 \\

 ./k
Sep 13 2020 16GB (c) shakti
 \\
</pre></div>

<span id="Simple-example"></span><h3 class="section">1.6 Simple example</h3>


<p>Here I will start up k9, perform some trivial calculations, and then close the session.  After this example it will be assumed the user will have a k9 session running and working in repl mode.  Comments (<code>/</code>) will be added to the end of lines as needed.  One can review <a href="#plus">plus</a>, <a href="#enum">enum</a>, <a href="#floor">floor</a> and <a href="#timing">timing</a> as needed. 
</p>
<div class="example">
<pre class="example"> 1+2  / add 1 and 2
3

 !5   / generate a list of 5 integers from 0 to 4
0 1 2 3 4

 1+!5 / add one to each element of the list
1 2 3 4 5

 !_100e6;     / generate a list of 100 million integers (suppress output with ;)
 1+!_100e6;   / do 100 million sums
 \t 1+!_100e6 / time the operations in milliseconds
82
</pre></div>

<p>Now let&rsquo;s exit the session.
</p>
<div class="example">
<pre class="example"> \\
bash-3.2$ 
</pre></div>


<span id="Document-formatting-for-code-examples"></span><h3 class="section">1.7 Document formatting for code examples</h3>
<p>This document uses a number of examples to familiarize the reader with k9.  The sytax is to have input with a leading space and output without a leading space.  This follows the terminal syntax where the REPL input has space but prints output without.
</p><div class="example">
<pre class="example"> 3+2 / this is input
5    / this is output
</pre></div>

<span id="k9-Idiosyncracies"></span><h3 class="section">1.8 k9 Idiosyncracies</h3>
<p>One will need to understand some basic rules of k9 in order to progress.  These may seem strange at first but the faster you learn them, the faster you&rsquo;ll move forward. Also, some of them, like overloading based on number of arguments, add a lot of expressability to the language.
</p>
<span id="The-language-changes-often-_0028for-now_0029_002e"></span><h4 class="subsection">1.8.1 The language changes often (for now).</h4>
<p>There may be examples in this document which work on the version indicated but do not with the version currently available to download.  If so, then feel free to drop the author a note.  Items which currently cause an error but are likely to come back &rsquo;soon&rsquo; will be left in the document.
</p>
<span id="Colon-_0028_003a_0029-is-used-to-set-a-variable-to-a-value"></span><h4 class="subsection">1.8.2 Colon (<code>:</code>) is used to set a variable to a value</h4>
<p><code>a:3</code> is used to set the variable, a, to the value, 3.  <code>a=3</code> is an equality test to determine if a is equal to 3.
</p>
<span id="Percent-_0028_0025_0029-is-used-to-divide-numbers"></span><h4 class="subsection">1.8.3 Percent (<code>%</code>) is used to divide numbers</h4>
<p>Yeah, 2 divided by 5 is written as <code>2%5</code>, not <code>2/5</code>.
</p>
<span id="Evaluation-is-done-right-to-left"></span><h4 class="subsection">1.8.4 Evaluation is done right to left</h4>
<p>2+5*3 is 17 and 2*5+3 is 16.  2+5*3 is first evaluated on the right most portion, 5*3, and once that is computed then it proceeds with 2+15.  2*5+3 goes to 2*8 which becomes 16.
</p>
<span id="There-is-no-arithmetic-order"></span><h4 class="subsection">1.8.5 There is no arithmetic order</h4>
<p>+ has equal precedence as *.  The order of evaluation is done right to left unless parenthesis are used.  (2+5)*3 = 21 as the 2+5 in parenthesis is done before being multiplied by 3.
</p>
<span id="Operators-are-overloaded-depending-on-the-number-of-arguments_002e"></span><h4 class="subsection">1.8.6 Operators are overloaded depending on the number of arguments.</h4>
<div class="example">
<pre class="example">&nbsp;*(13;6;9)    / single argument: * returns the first element
13
&nbsp;2*(13;6;9)   / two arguments: * is multiplication
26 12 18
</pre></div>

<span id="Lists-and-functions-are-very-similar_002e"></span><h4 class="subsection">1.8.7 Lists and functions are very similar.</h4>
<p>k9 syntax encourages you to treat lists and functions in a similar function.  They should both be thought of a mapping from a value to another value or from a domain to a range. Lists and functions do not have the same type.
</p>
<div class="example">
<pre class="example"> l:3 4 7 12
 f:{3+x*x}
 l@2
7
 f@2
7
 @l
`I
 @f
`.
</pre></div>

<span id="k9-notions-of-Noun_002c-Verb_002c-and-Adverb"></span><h4 class="subsection">1.8.8 k9 notions of Noun, Verb, and Adverb</h4>
<p>k9 uses an analogy with grammar to describe language syntax.  The k9 grammar consists of nouns (data), verbs (functions) and adverbs (function modifiers).
</p><ul>
<li> <tt>The boy ate an appple. (Noun verb noun)</tt>
</li><li> <tt>The girl ate each olive. (Noun verb adverb noun)</tt>
</li></ul>
<p>In k9 as the Help/Info card shows data are nouns, functions/lists are verbs and modifiers are adverbs.
</p><ul>
<li> <tt>3 &gt; 2 (Noun verb noun)</tt>
</li><li> <tt>3 &gt;' (1 12;1 4 5) (Noun verb adverb noun)</tt>
</li></ul>

<hr>
<span id="Verb"></span><div class="header">
<p>
Next: <a href="#Adverb" accesskey="n" rel="next">Adverb</a>, Previous: <a href="#Introduction" accesskey="p" rel="prev">Introduction</a>, Up: <a href="#Top" accesskey="u" rel="up">Top</a> &nbsp; </p>
</div>
<span id="Verbs"></span><h2 class="chapter">2 Verbs</h2>
<p>This chapter covers verbs which are the core primitives of k9.  Given how different is it to call functions in k9 than in most other languages, you may have to read this chapter  a few times.  Once you can &ldquo;speak&rdquo; k9 you&rsquo;ll read <code>|x</code> better than <code>reverse(x)</code>.  
</p>
<p>Most functions are overloaded and change depending on the number of arguments.  This can confuse new users.  Eg. <code>(1 4)++(2 3;5 6;7 8)</code> contains the plus symbol once as flip and then for addition.  (Remember evaluation is right to left!)
</p>
<p>There are verbs that can take a function argument. Those are listed with a &rsquo;[f]&rsquo; prefix.  These include [f]cut, [f]take, and [f]drop.  A few can take a special name prefix and those are listed with a &rsquo;n&rsquo; prefix and include [n]find, and [n]at.
</p>
<div class="example">
<pre class="example">Verb
: <a href="#x">x</a>,         <a href="#set">set</a>.
+ <a href="#flip">flip</a>,      <a href="#plus">plus</a>.
- <a href="#negate">negate</a>,    <a href="#minus">minus</a>.
* <a href="#first">first</a>,     <a href="#times">times</a>.
%            <a href="#divide">divide</a>.
&amp; <a href="#where">where</a>,     <a href="#min_002fand">min/and</a>.
| <a href="#reverse">reverse</a>,   <a href="#max_002for">max/or</a>.
&lt; <a href="#asc">asc</a>,       <a href="#less">less</a>.
&gt; <a href="#asc">desc</a>,      <a href="#less">more</a>.
= <a href="#group">group</a>,     <a href="#equal">equal</a>.
~ <a href="#not">not</a>,       <a href="#match">match</a>.
! <a href="#enum">enum</a>,      <a href="#key">key</a>.
, <a href="#enlist">list</a>,      <a href="#cat">cat</a>.
^ <a href="#sort">sort</a>,   [f]<a href="#cut">cut</a>. 
# <a href="#count">count</a>,  [f]<a href="#take">take</a>.  
_ <a href="#floor">floor</a>,  [f]<a href="#drop">drop</a>.    
$ <a href="#string">string</a>,    <a href="#parse">parse</a>.    
? <a href="#unique">unique</a>, [n]<a href="#find">find</a>.    
@ <a href="#type">type</a>,   [n]<a href="#at">at</a>.    
. <a href="#value">value</a>,     <a href="#dot">dot</a>.

</pre></div>

<span id="x"></span><span id="x-_21d2-_003ax"></span><h3 class="section">2.1 x &rArr; :x</h3>

<span id="set"></span><span id="set-_21d2-x_003ay"></span><h3 class="section">2.2 set &rArr; x:y</h3>
<p>Set a variable, x, to a value, y.  There should be no space between <code>x</code> and <code>:</code>. 
</p>
<div class="example">
<pre class="example">&nbsp;a:3
&nbsp;a
3
&nbsp;b:(`green;37;&quot;blue&quot;)
&nbsp;b
green
37
blue
&nbsp;c:{x+y}
&nbsp;c
{x+y}
&nbsp;c[12;15]
27
</pre></div>

<span id="flip"></span><span id="flip-_21d2-_002bx"></span><h3 class="section">2.3 flip &rArr; +x</h3>
<p>Flip, or transpose, x where x is not a simple element.  
</p>
<div class="example">
<pre class="example"> x:((1 2);(3 4);(5 6))
 x
1 2
3 4
5 6

 +x
1 3 5
2 4 6

 `a`b!+x
a|1 3 5
b|2 4 5

 +`a`b!+x
a b
- -
1 2
3 4
5 6
</pre></div>

<span id="plus"></span><span id="plus-_21d2-x_002by"></span><h3 class="section">2.4 plus &rArr; x+y</h3>
<p>Add x and y.  Arguments can be elements or lists but if both x and y are lists then they must be of equal length.
</p>
<div class="example">
<pre class="example"> 3+7
10

a:3;
 a+8
11

 3+4 5 6 7
7 8 9 10

3 4 5+4 5 6
7 9 11

 3 4+1 2 3        / lengths don't match
:length

&nbsp;10:00+1         / add a minute
10:01

&nbsp;10:00:00+1      / add a second
10:00:01

&nbsp;10:00:00.000+1  / add a millisecond
10:00:00.001
</pre></div>

<span id="negate"></span><span id="negate-_21d2-_002dx_002e"></span><h3 class="section">2.5 negate &rArr; -x.</h3>

<div class="example">
<pre class="example">&nbsp;-3
-3
&nbsp;--3
3
&nbsp;x:4;
&nbsp;-x
-4
&nbsp;d:`a`b!((1 2 3);(4 5 6))
&nbsp;-d
a|-1 -2 -3
b|-4 -5 -6
</pre></div>

<span id="minus"></span><span id="minus-_21d2-x_002dy_002e"></span><h3 class="section">2.6 minus &rArr; x-y.</h3>
<p>Subtract y from x.
</p>
<div class="example">
<pre class="example">&nbsp;5-2
3
&nbsp;x:4;y:1;
&nbsp;x-y
3
</pre></div>

<span id="first"></span><span id="first-_21d2-_002ax"></span><h3 class="section">2.7 first &rArr; *x</h3>
<p>Return the first value of x.  
</p><div class="example">
<pre class="example"> *1 2 3
1
 *((1 2);(3 4);(5 6))
1 2
 **((1 2);(3 4);(5 6))
1
 *`a`b!((1 2 3);(4 5 6))
1 2 3
 *|1 2 3
3
</pre></div>

<span id="times"></span><span id="times-_21d2-x_002ay"></span><h3 class="section">2.8 times &rArr;  x*y</h3>
<p>Mutliply x and y.
</p><div class="example">
<pre class="example">&nbsp;3*4
12
&nbsp;3*4 5 6
12 15 18
&nbsp;1 2 3*4 5 6
4 10 18
</pre></div>

<span id="divide"></span><span id="divide-_21d2-x_0025y"></span><h3 class="section">2.9 divide &rArr; x%y</h3>
<p>Divide x by y.
</p><div class="example">
<pre class="example">&nbsp;12%5
2.4
&nbsp;6%2    / division of two integers returns a float
3f
</pre></div>

<span id="where"></span><span id="where-_21d2-_0026x"></span><h3 class="section">2.10 where &rArr; &amp;x</h3>
<p>Given a list of boolean values return the indices where the value is non-zero.   
</p>
<div class="example">
<pre class="example"> &amp;001001b
2 5
 &quot;banana&quot;=&quot;a&quot;
010101b
 &amp;&quot;banana&quot;=&quot;a&quot;
1 3 5
 x@&amp;30&lt;x:12.7 0.1 35.6 -12.1 101.101  / return values greater than 30
35.6 101.101
</pre></div>

<p>Given a list of non-negative integer values, eg. x[0], x[1], ..., x[n-1], generate x[0] values of 0,
x[1] values of 1, ..., and x[n-1] values of n-1. 
</p>
<div class="example">
<pre class="example"> &amp; 3 1 0 2
0 0 0 1 3 3

</pre></div>

<span id="min_002fand"></span><span id="and-_21d2-x_0026y"></span><h3 class="section">2.11 and &rArr; x&amp;y</h3>
<p>The smaller of x and y.  One can use the over adverb to determine the min value in a list.
</p><div class="example">
<pre class="example">&nbsp;3&amp;2
2
&nbsp;1 2 3&amp;4 5 6
1 2 3
&nbsp;010010b&amp;111000b
010000
&nbsp;`a&amp;`b
`a
&nbsp;&amp;/ 3 2 10 -200 47
-200
</pre></div>

<span id="reverse"></span><span id="reverse-_21d2-_007cx"></span><h3 class="section">2.12 reverse &rArr; |x</h3>
<p>Reverse the list x.
</p><div class="example">
<pre class="example">&nbsp;|0 3 1 2
2 1 3 0
&nbsp;|&quot;banana&quot;
&quot;ananab&quot;
&nbsp;|((1 2 3);4;(5 6))
5 6  
4    
1 2 3
</pre></div>

<p>To get the last element, one can take  the first element of the reverse list (*|<em>`</em>a<em>`</em>b<em>`</em>c).
</p>
<span id="max_002for"></span><span id="or-_21d2-x_007cy"></span><h3 class="section">2.13 or &rArr; x|y</h3>
<p>The greater of x and y.  Max of a list can be determine by use of the adverb over.
</p><div class="example">
<pre class="example">&nbsp;3|2
3
&nbsp;1 2 3|4 5 6
4 5 6
&nbsp;101101b|000111b
101111b
&nbsp;|/12 2 3 10 / use over to determine the max of a list
12
</pre></div>

<span id="asc"></span><span id="desc"></span><span id="asc_0028desc_0029-_21d2-_003c-_0028_003e_0029-x"></span><h3 class="section">2.14 asc(desc) &rArr; &lt; (&gt;) x</h3>
<p>Sort a list or dictionary in ascending (&lt;) or descending (&gt;) order.  Applied to a list, these will return the indices to be used to achieve the sort.
</p>
<div class="example">
<pre class="example"> &lt;5 7 0 12
2 0 1 3

 x@&lt;x:5 7 0 12
0 5 7 12

 d:`a`b`c!3 2 1;d
a|3
b|2
c|1

 &lt;d / a dictionary is sorted by value
c|1
b|2
a|3
</pre></div>

<span id="less"></span><span id="more"></span><span id="less-_0028more_0029-_21d2-x-_003c-_0028_003e_0029-y"></span><h3 class="section">2.15 less (more) &rArr; x &lt; (&gt;) y</h3>
<p>Return true (1b) if x is less (more) than y else false (0b).
</p><div class="example">
<pre class="example">&nbsp;3&lt;2
0b
&nbsp;2&lt;3
1b
&nbsp;1 2 3&lt;4 5 6
111b
&nbsp;((1 2 3);4;(5 6))&lt;((101 0 5);12;(10 0)) / size needs to match
101
1  
10
&nbsp;&quot;a&quot;&lt;&quot;b&quot;
1b
</pre></div>

<span id="group"></span><span id="group-_21d2-_003dx"></span><h3 class="section">2.16 group &rArr; =x</h3>
<p>A dictionary of the distinct values of x (key) and their indices (values).
</p><div class="example">
<pre class="example">&nbsp;=&quot;banana&quot;
a|1 3 5
b|0    
n|2 4  
&nbsp;=0 1 0 2 10 7 0 1 12
 0|0 2 6
 1|1 7  
 2|3    
 7|5    
10|4    
12|8    
</pre></div>

<span id="equal"></span><span id="equal-_21d2-x_003dy"></span><h3 class="section">2.17 equal &rArr; x=y</h3>
<p>Return true (1b) if x is equal to y else false (0b).  
</p>
<div class="example">
<pre class="example"> 2=2
1b
 2=3
0b
 2=2.
1b
 &quot;banana&quot;=&quot;abnaoo&quot; / check strings of equal length by character
001100b
 &quot;banana&quot;=&quot;apple&quot;  / unequal length strings error
^
:length
</pre></div>

<span id="not"></span><span id="not-_21d2-_007ex"></span><h3 class="section">2.18 not &rArr; ~x</h3>
<p>Boolean invert of x
</p><div class="example">
<pre class="example">&nbsp;~1b
0b
&nbsp;~101b
010b
&nbsp;~37 0 12
010b
</pre></div>

<span id="match"></span><span id="match-_21d2-x_007ey"></span><h3 class="section">2.19 match &rArr; x~y</h3>
<p>Return true (1b) if x matches y else false (0b).  A match happens if the two arguments evaluate to the same expression.
</p>
<div class="example">
<pre class="example"> 2~2
1b
 2~3
0b
 2~2.
0b
 &quot;banana&quot;~&quot;apple&quot;
0b
 `a`b~`a`b  / different than = which is element-wise comparison
1b
 `a`b=`a`b
11b
 f:{x+y}
 f~{x+y}
1b
</pre></div>

<span id="enum"></span><span id="enum-_21d2-_0021x"></span><h3 class="section">2.20 enum &rArr; !x</h3>
<p>Enumerate the domain of x.  Given an integer, x, generate an integer list from 0 to x-1.  Given a dictionary, x, return all key values.  
</p>
<div class="example">
<pre class="example"> !3
0 1 2

 !`a`b`c!3 2 1
`a`b`c
</pre></div>

<p>In the case where x is a list of integers  x1 x2 ... xk, generate a matrix of k rows where each row has size */x1 x2 ... xk and the elements of row i are !xi repeated as many times as necessary. Each row&rsquo;s repeats must fit below constant values of the row above.
</p>
<div class="example">
<pre class="example"> / Each row of length 2*3*2 = */2 3 2 = 12.
 / First row values 0,1
 / Second row values 0,1,2
 / Third row values 0,1
 !2 3 2 
0 0 0 0 0 0 1 1 1 1 1 1
0 0 1 1 2 2 0 0 1 1 2 2
0 1 0 1 0 1 0 1 0 1 0 1

 !4 2 3
0 0 0 0 0 0 1 1 1 1 1 1 2 2 2 2 2 2 3 3 3 3 3 3
0 0 0 1 1 1 0 0 0 1 1 1 0 0 0 1 1 1 0 0 0 1 1 1
0 1 2 0 1 2 0 1 2 0 1 2 0 1 2 0 1 2 0 1 2 0 1 2

 !2 2 2
0 0 0 0 1 1 1 1
0 0 1 1 0 0 1 1
0 1 0 1 0 1 0 1

 +!2 2 2
0 0 0
0 0 1
0 1 0
0 1 1
1 0 0
1 0 1
1 1 0
1 1 1
</pre></div>

<span id="key"></span><span id="key-_21d2-x_0021y"></span><h3 class="section">2.21 key &rArr; x!y</h3>
<p>Dictionary of x (key) and y (value).  
</p>
<div class="example">
<pre class="example">&nbsp;3!7
,3!,7
&nbsp;`a`b!3 7
a|3
b|7
&nbsp;`a`b!((1 2);(3 4))
a|1 2
b|3 4
</pre></div>

<span id="enlist"></span><span id="enlist-_21d2-_002cx"></span><h3 class="section">2.22 enlist &rArr; ,x</h3>
<p>Create a list from x
</p>
<div class="example">
<pre class="example">&nbsp;,3
,3
&nbsp;,1 2 3
1 2 3
&nbsp;3=,3
,1b
&nbsp;3~,3
0b
</pre></div>

<span id="cat"></span><span id="cat-_21d2-x_002cy"></span><h3 class="section">2.23 cat &rArr; x,y</h3>
<p>Concatenate x and y.
</p>
<div class="example">
<pre class="example"> 3,7
3 7

 &quot;hello&quot;,&quot; &quot;,&quot;there&quot;
&quot;hello there&quot;

 C:(&quot;ab&quot;;&quot;c&quot;;(&quot;def&quot;;&quot;ghi&quot;));C
ab           
c            
(&quot;def&quot;;&quot;ghi&quot;)

 ,/C     / join the list once
a  
b  
c  
def
ghi

 ,//:C   / converge over join until single list
&quot;abcdefghi&quot;
</pre></div>

<span id="sort"></span><span id="sort-_21d2-_005ex"></span><h3 class="section">2.24 sort &rArr; ^x</h3>
<p>Sort list, dictionary, or table x into ascending order.  Dictionaries are sorted using the keys and tables by the first column field.  One can sort tables by arbitrary columns by first reordering the columns in the table using <a href="#take">take</a> or by extracting the sort column by index or expression.
</p>
<div class="example">
<pre class="example"> ^0 3 2 1
0 1 2 3

^`b`a!((0 1 2);(7 6 5))     / sort dictionary by key
[a:7 6 5;b:0 1 2]

 ^[[]z:`c`a`b;y:3 2 1]      / sort table by 1st col
z y
- -
a 2
b 1
c 3

 ^`y`z#[[]z:`c`a`b;y:3 2 1] / sort table by new 1st col
y z
- -
1 b
2 a
3 c
</pre></div>

<span id="cut"></span><span id="g_t_005bf_005dcut-_21d2-x_005ey"></span><h3 class="section">2.25 [f]cut &rArr; x^y</h3>
<p>Cut list y by size, indices, or function x.  
</p>
<table>
<tr><td><b>action</b></td><td><b>x</b></td></tr>
<tr><td><a href="#cut1">rows</a></td><td>positive int</td></tr>
<tr><td><a href="#cut2">columns</a></td><td>negative int</td></tr>
<tr><td><a href="#cut3">indices</a></td><td>list</td></tr>
<tr><td><a href="#cut4">function</a></td><td>function</td></tr>
</table>

<span id="cut1"></span><p>Positve integer x, cut y into x rows
</p><div class="example">
<pre class="example"> 3^101+!20   / 3 rows
101 102 103 104 105 106
107 108 109 110 111 112
113 114 115 116 117 118
</pre></div>

<span id="cut2"></span><p>Negative integer, cut y into x elements per row
</p><div class="example">
<pre class="example"> -3^101+!20  / 3 elements in each row
101 102 103
104 105 106
107 108 109
110 111 112
113 114 115
116 117 118
</pre></div>

<span id="cut3"></span><p>Positive integer array x, cut at each element in x
</p><div class="example">
<pre class="example"> 2 3 7 ^!17  / left list indicates start number of each row.
,2                        
3 4 5 6                   
7 8 9 10 11 12 13 14 15 16

 8 9 10 11 12^.1*!20
,0.8                           
,0.9                           
,1.                            
,1.1                           
1.2 1.3 1.4 1.5 1.6 1.7 1.8 1.9
</pre></div>

<span id="cut4"></span><p>Function returning boolean array, cut at each index where f is non-zero.
</p><div class="example">
<pre class="example"> {(x*x)within .5 1.5}^.1*!20
0.8                            
0.9                            
1.                             
1.1                            
1.2 1.3 1.4 1.5 1.6 1.7 1.8 1.9
</pre></div>

<span id="count"></span><span id="count-_21d2-_0023x"></span><h3 class="section">2.26 count &rArr; #x</h3>
<p>Count the number of elements in list, dictionary, or table x.
</p>
<div class="example">
<pre class="example"> #0 1 2 12
4

 #((0 1 2);3;(4 5))
3
 #`a`b!((1 2 3);(4 5 6)) / count the number of keys
2

 #5                      / will error as an element
#5
^
!class
</pre></div>

<span id="take"></span><span id="g_t_005bf_005dtake-_21d2-x_0023y"></span><h3 class="section">2.27 [f]take &rArr; x#y</h3>
<p>[f]take has a number of different actions depending on x.  These include head (take from front of list), tail (take from back of list), common (take common elements), filter (take where function is non-zero), and select (take columns from table).
</p>
<table>
<tr><td><b>action</b></td><td><b>x</b></td><td><b>y</b></td></tr>
<tr><td><a href="#take1">head</a></td><td>positive int</td><td>list</td></tr>
<tr><td><a href="#take1">tail</a></td><td>negative int</td><td>list</td></tr>
<tr><td><a href="#take2">common</a></td><td>list</td><td>list / dictionary</td></tr>
<tr><td><a href="#take3">filter</a></td><td>function</td><td>list</td></tr>
<tr><td><a href="#take4">select</a></td><td>name(s)</td><td>table</td></tr>
</table>

<span id="take1"></span><p>Postive (negative) x returns the first (last) x elements of y.  If abs[x]&gt;count[y] then repeatedly pull from y.
</p>
<div class="example">
<pre class="example"> 3#0 1 2 3 4 5          / take first 3 elements of a list
0 1 2

 10 # 17 12 25 / take repeat: take from list and repeat as needed
17 12 25 17 12 25 17 12 25 17

 -3#0 1 2 3 4 5         / take last elements of a list
3 4 5


</pre></div>

<span id="take2"></span><p>If x and y are lists, then take returns any values common in both x and y.  If x is a list and y is a dictionary, then take returns those values in y where the keys are in x.
</p>
<div class="example">
<pre class="example"> (1 2 3 7 8 9)#(2 8 20) / common
2 8

  (2 4 6 2 6 5 4) # (4 6 7 8 2 4 4 4) / substring of right argument
4 6 2 4 4 4
 
 (4 6 7 8 2 4 4 4) # (2 4 6 2 6 5 4)
2 4 6 2 6 4

 `b`d#`a`b`c`d!1 4 2 3
b|4
d|3
</pre></div>

<span id="take3"></span><p>If x is a function, then select the values where the function is non-zero.
</p>
<div class="example">
<pre class="example"> (0.5&lt;)#10 rand 1.           / select values greater than 0.5
0.840732 0.5330717 0.7539563 0.643315 0.6993048f
</pre></div>

<span id="take4"></span><p>If x is a name or list of names, then take the name column or columns from the table.
</p>
<div class="example">
<pre class="example"> t:[[]x:`a`b`c;y:3 1 2;z:&quot;tab&quot;];t
x y z
- - -
a 3 t
b 1 a
c 2 b

 `y#t
y
-
3
1
2

 `z`y#t
z y
- -
t 3
a 1
b 2

 `x`z`y#t
x z y
- - -
a t 3
b a 1
c b 2
</pre></div>

<span id="floor"></span><span id="floor-_21d2-_005fx"></span><h3 class="section">2.28 floor &rArr; _x</h3>
<p>Return the integer floor of float x.
</p><div class="example">
<pre class="example">&nbsp;_3.7
3
</pre></div>

<span id="drop"></span><span id="g_t_005bf_005ddrop-_21d2-x_005fy"></span><h3 class="section">2.29 [f]drop &rArr; x_y</h3>
<p>[f]drop has a number of different actions depending on x.  This include de-head (drop from front of list), de-tail (drop from back of list), uncommon (drop common elements), and filter (drop where function is zero).
</p>
<table>
<tr><td><b>action</b></td><td><b>x</b></td><td><b>y</b></td></tr>
<tr><td><a href="#drop1">dehead</a></td><td>positive int</td><td>list</td></tr>
<tr><td><a href="#drop1">detail</a></td><td>negative int</td><td>list</td></tr>
<tr><td><a href="#drop2">uncommon</a></td><td>list</td><td>list / dictionary</td></tr>
<tr><td><a href="#drop3">filter</a></td><td>function</td><td>list</td></tr>
</table>

<span id="drop1"></span><p>Postive (negative) x drops the first (last) x elements of y.  
</p>
<div class="example">
<pre class="example"> 3_0 1 2 3 4 5          / drop first three
3 4 5

 -2_0 1 2 3 4 5         / drop last three
0 1 2 3
</pre></div>

<span id="drop2"></span><p>If x and y are lists, then drop returns any values from y not found in x.  If x is a list and y is a dictionary, then drop returns those values in y where the keys are not in x.
</p>
<div class="example">
<pre class="example"> (1 2 3 7 8 9)_(2 8 20) / uncommon
,20

 `b`d_`a`b`c`d!1 4 2 3
a|1
c|2
</pre></div>

<span id="drop3"></span><p>If x is a function, then select values where the function is zero.
</p>
<div class="example">
<pre class="example"> (0.5&lt;)_10 rand 1.           / values less than or equal to 0.5
0.02049699 0.1269226
</pre></div>

<span id="string"></span><span id="string-_21d2-_0024x"></span><h3 class="section">2.30 string &rArr; $x</h3>
<p>Cast x to string.
</p><div class="example">
<pre class="example"> $`abc
&quot;abc&quot;
 $4.7
&quot;4.7&quot;
</pre></div>

<span id="parse"></span><span id="parse-_21d2-x_0024y"></span><h3 class="section">2.31 parse &rArr; x$y</h3>
<p>Parse string y into type x.
</p>
<div class="example">
<pre class="example"> `i$&quot;23&quot;
23
 `f$&quot;2.3&quot;
2.3
 `t$&quot;12:34:56.789&quot;
12:34:56.789
 `d$&quot;2020.04.20&quot;
2020.04.20
</pre></div>

<span id="unique"></span><span id="unique-_21d2-_003fx"></span><h3 class="section">2.32 unique &rArr; ?x</h3>
<p>Return the unique values of the list x.  The <code>?</code> preceeding the return value explicitly shows that the list has no repeated values.
</p>
<div class="example">
<pre class="example">&nbsp;?`f`a`b`c`a`b`d`e`a
?`f`a`b`c`d`e
&nbsp;?&quot;banana&quot;
?&quot;ban&quot;
</pre></div>

<span id="find"></span><span id="g_t_005bn_005dfind-_21d2-x_003fy"></span><h3 class="section">2.33 [n]find &rArr; x?y</h3>
<p>Find the first element of x that matches y otherwise return the end of vector.
</p>
<div class="example">
<pre class="example"> `a`b`a`c`b`a`a?`b
1
&nbsp;`a`b`a`c`b`a`a?`d / missing thus return the list length
7
&nbsp;0 1 2 3 4?10
5
&nbsp;(1;`a;&quot;blue&quot;;7.4)?3
4
</pre></div>

<p>Return random numbers.  Documented at <a href="#rand">rand</a>.
</p>
<div class="example">
<pre class="example"> 3?1.
0.01640292 0.8029538 0.9569196
</pre></div>

<p>There is also another use of <code>?</code> where x is a special name, eg. <em>`</em>js, <em>`</em>csv (or <em>`</em>cs), or <em>`</em>nv.  This is further discussed in the <a href="#I_002fO">I/O</a> section.
</p>
<span id="type"></span><span id="type-_21d2-_0040x"></span><h3 class="section">2.34 type &rArr; @x</h3>
<p>Return the data type of x.  Lower-case represents a single element while upper-case represents a list of type indicated.
</p>
<div class="example">
<pre class="example">@1 / 0 ro 1 will show up as binary
`b

@2
`i

@1.2
`f

@`a
`n

@&quot;a&quot;
`c

@2020.04.20
`d

@12:34:56.789
`t

@(1;1.2;`a;&quot;a&quot;;2020.04.20;12:34:56.789)  / type of a list
`:

@'(1;1.2;`a;&quot;a&quot;;2020.04.20;12:34:56.789) / type of elements of the list
`i`f`s`c`d`t

@{x*x}
`.

@`a`b!1 2
`a
</pre></div>

<span id="at"></span><span id="g_t_005bn_005dat-_21d2-x_0040y"></span><h3 class="section">2.35 [n]at &rArr; x@y</h3>
<p>Given a list or function x return the value(s) at index(indices) y.  
</p>
<div class="example">
<pre class="example"> (3 4 7 12)@2              / list
7

 `a`b`c@2
`c

 ((1 2);3;(4 5 6))@(0 1)   / values at indices 0 and 1
1 2
3

 {x*x}@3                   / function
9

 (sin;cos;1*)@\:0.01
0.009999833 0.99995 0.01

 (sqr;sqrt;|;#)@'(3;10;&quot;word&quot;;`a`b`c) / list of fuctions applied to list of inputs
9       
3.162278
drow    
3       
</pre></div>

<p>There is also another use of <code>@</code> where x is a special name, eg. <em>`</em>js, <em>`</em>csv (or <em>`</em>cs), or <em>`</em>nv.  This is further discussed in the <a href="#I_002fO">I/O</a> section.
</p>
<span id="value"></span><span id="value-_21d2-_002ex"></span><h3 class="section">2.36 value &rArr; .x</h3>
<p>Evaluate a string of valid k code or list of k code.  Can also be used to covert from a string to a numeric, 
temporal or name type.
</p>
<div class="example">
<pre class="example"> .&quot;3+2&quot;
5

 .&quot;20*1+!3&quot;
20 40 60

 .(*;16;3)
48

 n:3;p:+(n rand(+;-;*;%);1+n rand 10;1+n rand 10);p
% 6 3
* 2 7
- 5 5

 .'p
2 
14
0

 .&quot;15&quot;
15

 .&quot;12.7&quot;
12.7

 .&quot;`abc&quot;
`abc
</pre></div>

<span id="dot"></span><span id="dot-_21d2-x_002ey"></span><h3 class="section">2.37 dot &rArr; x.y</h3>
<p>Given list x return the value at list y.  The action of dot depends on the shape of y.
</p><ul>
<li> Index returns the value(s) at x at each index y, i.e. x@y@0, x@y@1, ..., x@y@(n-1).
</li><li> Recursive index returns the value(s) at x[y@0;y@1].
</li><li> Recursive index over returns x[y[0;0];y[1]], x[y[0;1];y[1]], ..., x[y[0;n-1];y[1]].
</li></ul>

<table>
<tr><td><b>action</b></td><td><b>@y</b></td><td><b>#y</b></td><td><b>example</b></td></tr>
<tr><td>simple index</td><td><em>`</em>I</td><td>1</td><td>,2</td></tr>
<tr><td>simple indices</td><td><em>`</em>I</td><td>1</td><td>,1 3</td></tr>
<tr><td>recursive index</td><td><em>`</em>L</td><td>1</td><td>0 2</td></tr>
<tr><td>recursive index over</td><td><em>`</em>L</td><td>2</td><td>(0 2;1 3)</td></tr>
</table>

<div class="example">
<pre class="example">&nbsp;(3 4 7 12).,2
7
&nbsp;`a`b`c.,2
`c
&nbsp;x:(`x00`x01;`x10`x11`x12;`x20;`x30`x31`x32);x
x00 x01    
x10 x11 x12
x20        
x30 x31 x32

&nbsp;x . ,1
`x10`x11`x12
&nbsp;x . ,0 1 3
x00 x01    
x10 x11 x12
x30 x31 x32

&nbsp;x . 3 1
`x31
&nbsp;x . (1 3;0 1)
x10 x11
x30 x31
</pre></div>

<p>If x is a function then apply the function to y.
</p>
<div class="example">
<pre class="example"> (+). 3 2
5

 (+;-;*;%).\: 3 2
5  
1  
6  
1.5

 a:{x+y};b:{x*sin y};a . 3 1
4
 a . 3 1
4
 b . 3 1
2.524413

 (!).(`a`b`c;1 2 3)
a|1
b|2
c|3
</pre></div>

<hr>
<span id="Adverb"></span><div class="header">
<p>
Next: <a href="#Noun" accesskey="n" rel="next">Noun</a>, Previous: <a href="#Verb" accesskey="p" rel="prev">Verb</a>, Up: <a href="#Top" accesskey="u" rel="up">Top</a> &nbsp; </p>
</div>
<span id="Adverbs"></span><h2 class="chapter">3 Adverbs</h2>
<p>This chapter may be one of the most difficult for users new to array langauges but one must master adverbs to exploit the full power of k9.  Nouns and verbs naturally come but adverbs need to be learned so that one can reach for them when needed.
</p>
<div class="example">
<pre class="example">Adverb
   f'  <a href="#each">each</a>
[x]f/  <a href="#scan">over</a> (c/<a href="#join">join</a>)
[x]f\  <a href="#scan">scan</a> (c\<a href="#split">split</a>)
[y]f': <a href="#eachp">eachp</a>
   f/: <a href="#eachr">eachr</a> g/:<a href="#cover">over</a> 
   f\: <a href="#eachl">eachl</a> g\:<a href="#cscan">scan</a> 
</pre></div>

<p>Adverbs modify verbs to operative iteratively over nouns.  This previous sentence likely will  make sense only once you understand it so let&rsquo;s jump into an example.  Imagine you have a list of 4 lists.  Using <code>first</code> you will retrieve the first sub-list.  In order to retrieve the first element of each sub-list you&rsquo;ll have to modify the function <code>first</code> with a modifier <code>each</code>.
</p>
<div class="example">
<pre class="example"> x:(1 2; 3 4; 5 6; 7 8);x
1 2
3 4
5 6
7 8

*x   / first
1 2

*'x  / each first
1 3 5 7
</pre></div>

<p>Adverbs area also used where one might use a <code>for</code>, <code>do</code>, or <code>while</code> loop to calculate over a list of value or recursively until a condition is met.
</p>
<div class="example">
<pre class="example"> f:{x*y}   
 f\1 .1 .1 .1 / f\ scan over list
1    
0.1  
0.01 
0.001

 g:{x*x}
 g\:.99       / g\: scan until convergence
0.99 0.9801 0.960596 .. 8.87948e-287 0
</pre></div>

<span id="each"></span><span id="each-_21d2-f_0027x"></span><h3 class="section">3.1 each &rArr; f&rsquo;x</h3>
<p>Apply function f to each value in list x in a single thread.  Multithread operation is done with <a href="#eachp">eachp</a>.  
</p>
<div class="example">
<pre class="example"> *((1 2 3);4;(5 6);7)   / first element of the list
1 2 3

 *'((1 2 3);4;(5 6);7)  / first element of each element
1 4 5 7

 !3                     / simple list
0 1 2
 +/!3                   / sum of the list
3
 2#'!3                  / take 5 copies of the list
0 0
1 1
2 2
 +/2#'!3                / sum
3 3
 +/'2#'!3               / sum each, eg. (0 1 2)+(0 1 2)
0 2 4
</pre></div>

<span id="over"></span><span id="over-_21d2-f_002fy-or-x-f_002fy"></span><h3 class="section">3.2 over &rArr; f/y or x f/y</h3>
<p>Over has the same function as <a href="#scan">scan</a> but returns only the last value.
</p>
<span id="scan"></span><span id="scan-_21d2-f_005cy-or-x-f_005cy"></span><h3 class="section">3.3 scan &rArr; f\y or x f\y</h3>
<p>Compute f, a function of two arguments, over list y with optional initial value x.  On the first iteration return y<sub>0</sub>.  On each subsequent iteration function will be called with previous output and the next element of y as arguments, i.e. f<sub>i</sub>=f[f<sub>i-1</sub>;y<sub>i</sub>].  Calling with f, a function of one argument, is covered in <a href="#each">each</a>.
</p>
<table>
<tr><td><b>i</b></td><td><b>x</b></td><td><b>f[x]</b></td><td><b>a f[x]</b></td><td><b>x:0 1 4 9 16 25</b></td><td><b>+\x</b></td><td><b>3+\x</b></td><td><b>+/x</b></td><td><b>3+/x</b></td></tr>
<tr><td>0</td><td>x<sub>0</sub></td><td>x<sub>0</sub></td><td>f<sub>0</sub>[a;x<sub>0</sub>]</td><td>0</td><td>0</td><td>3</td><td></td><td></td></tr>
<tr><td>1</td><td>x<sub>1</sub></td><td>f<sub>1</sub>[f<sub>0</sub>;x<sub>1</sub>]</td><td>f<sub>1</sub>[f<sub>0</sub>;x<sub>1</sub>]</td><td>1</td><td>1</td><td>4</td><td></td><td></td></tr>
<tr><td>..</td><td>..</td><td>..</td><td>..</td><td>..</td><td>..</td><td>..</td><td></td><td></td></tr>
<tr><td>j</td><td>x<sub>j</sub></td><td>f<sub>j</sub>[f<sub>j-1</sub>;x<sub>j</sub>]</td><td>f<sub>j</sub>[f<sub>j-1</sub>;x<sub>j</sub>]</td><td>..</td><td>..</td><td>..</td><td></td><td></td></tr>
<tr><td>..</td><td>..</td><td>..</td><td>..</td><td>..</td><td>..</td><td>..</td><td></td><td></td></tr>
<tr><td>n-2</td><td>x<sub>n-2</sub></td><td>f<sub>n-2</sub>[f<sub>n-3</sub>;x<sub>n-2</sub>]</td><td>f<sub>n-2</sub>[f<sub>n-3</sub>;x<sub>n-2</sub>]</td><td>16</td><td>30</td><td>33</td><td></td><td></td></tr>
<tr><td>n-1</td><td>x<sub>n-1</sub></td><td>f<sub>n-1</sub>[f<sub>n-2</sub>;x<sub>n-1</sub>]</td><td>f<sub>n-1</sub>[f<sub>n-2</sub>;x<sub>n-1</sub>]</td><td>25</td><td>55</td><td>58</td><td>55</td><td>58</td></tr>
</table>


<p>Examples
</p><div class="example">
<pre class="example"> (,\)(&quot;a&quot;;&quot;b&quot;;&quot;c&quot;)   / scan and cat to build up a list
a
ab
abc

 +\1 20 300          / scan and plus to sum over a list
1 21 321

 {y+10*x}\1 20 300   / scan and user func
1 30 600

 {y+10*x}/1 20 300   / over and user func
600

 x:1 2 3               / x+y0, +y1, +y2
 y:10 10 10
 x+\y
11 12 13
21 22 23
31 32 33

 {x+.5*y}\[1 2 3;20 20 20]  / f\y syntax
11 12 13
21 22 23
31 32 33

 1 2 3{x+.5*y}\20 20 20    / i f\x syntax
11 12 13
21 22 23
31 32 33
</pre></div>

<span id="join"></span><span id="join-_21d2-c_002fx"></span><h3 class="section">3.4 join &rArr; c/x</h3>
<p>Join a list of strings x using character c between each pair.
</p>
<div class="example">
<pre class="example"> &quot;-&quot;/(&quot;Some&quot;;&quot;random text&quot;;&quot;plus&quot;;,&quot;.&quot;)
&quot;Some-random text-plus-.&quot;
</pre></div>

<p>The notaion c/x converts a list of integers x via base c into base 10. In the example below, assuming 2 0 1 are digits in base 8, they convert to  1 + (0*8) + (2*8*8) = 129
</p>
<div class="example">
<pre class="example"> 8/2 0 1  
129
</pre></div>

<span id="split"></span><span id="split-_21d2-c_005cx"></span><h3 class="section">3.5 split &rArr; c\x</h3>
<p>Split the string x using character c to determine the locations.
</p>
<div class="example">
<pre class="example"> &quot; &quot;\&quot;Here is a short sentence.&quot;
Here     
is       
a        
short    
sentence.
</pre></div>

<p>c\x splits a number x into base c digits.
</p>
<div class="example">
<pre class="example"> 8\129
2 0 1
</pre></div>

<span id="eachp"></span><span id="eachp-_21d2-f_0027_003a_005bx_003by_005d-or-y-f_0027_003ax"></span><h3 class="section">3.6 eachp &rArr; f&rsquo;:[x;y] or y f&rsquo;:x</h3>
<p>Compute f, a function of two arguments, over list x with optional initial value y.   Concretely f<sub>i</sub>=f[x<sub>i</sub>;x<sub>i-1</sub>] where f<sub>0</sub> returns f[x<sub>0</sub>;i].
</p>
<div class="example">
<pre class="example"> ,':[`i;(`$&quot;x&quot;,'$!5)]
x0 i 
x1 x0
x2 x1
x3 x2
x4 x3

 %':[100;100 101.9 105.1 102.3 106.1] / compute returns
1 1.019 1.031403 0.9733587 1.037146

 100%':100 101.9 105.1 102.3 106.1    / using infix notation
1 1.019 1.031403 0.9733587 1.037146

 101.9{($x),&quot; % &quot;,($y),&quot; = &quot;,$x%y}':100.1 101.9 105.1 102.3 106.1
100.1 % 101.9 = 0.9823356
101.9 % 100.1 = 1.017982 
105.1 % 101.9 = 1.031403 
102.3 % 105.1 = 0.9733587
106.1 % 102.3 = 1.037146 
</pre></div>

<p>Additionally eachp (&rsquo;:) is a multithreaded (parallel) each.  This will allow a function to run using multiple threads over a list of arguments.
</p>
<div class="example">
<pre class="example">\t {L:xrand 1.;sum L%sin L*cos L*sin L+L*L}':8#_50e6 / multiple threads
831

\t {L:xrand 1.;sum L%sin L*cos L*sin L+L*L}'8#_50e6  / single thread
1202
</pre></div>

<span id="eachr"></span><span id="eachr-_21d2-f_002f_003a_005bx_003by_005d"></span><h3 class="section">3.7 eachr &rArr; f/:[x;y]</h3>
<p>Apply f[x;y] to each value of y, i.e. the right one.
</p>
<div class="example">
<pre class="example"> (!2)+/:!3
0 1
1 2
2 3

 {x+10*y}/:[!2;!3]
0 1  
10 11
20 21
</pre></div>

<span id="eachl"></span><span id="eachl-_21d2-f_005c_003a_005bx_003by_005d"></span><h3 class="section">3.8 eachl &rArr; f\:[x;y]</h3>
<p>Apply f[x;y] to each value of x, i.e. the left one.
</p>
<div class="example">
<pre class="example"> (!2)+\:!3
0 1 2
1 2 3

 {x+10*y}\:[!2;!3]
0 10 20
1 11 21
</pre></div>

<span id="cover"></span><span id="Converge-Over-_21d2-f_002f_003ax-or-_0028n_003bf_0029_002f_003ax"></span><h3 class="section">3.9 Converge Over &rArr; f/:x or (n;f)/:x</h3>
<p>Converge Over is the same function as <a href="#cscan">Converge Scan</a> but only returns the final value(s).
</p>
<div class="example">
<pre class="example"> r:((1;2);3;(,4));r
1 2
3  
,4 

 ,//:r  / raze over the list until it converges to a flat list
1 2 3 4
</pre></div>

<span id="cscan"></span><span id="Converge-Scan-_21d2-f_005c_003ax-or-_0028n_003bf_0029_005c_003ax"></span><h3 class="section">3.10 Converge Scan &rArr; f\:x or (n;f)\:x</h3>
<p>Compute function f where f<sub>i</sub>=f[f<sub>i-1</sub>] and f<sub>0</sub>=x.  If n is specified then it is either (DO) the number of iterations or (WHILE) a function returning a non-zero result.  
</p>
<div class="example">
<pre class="example">  {x*x}\:.99           / converge to value
0.99 0.9801 0.9605961 ... 1.323698e-18 1.752177e-36 0.

 (3;{x*x})\:.99        / do 3 times, return 4 values (first is initial)
0.99 0.9801 0.960596 0.9227448

 (.5&lt;;{x*x})\:.99      / while .5 &lt; r, i.e. r is greater than 0.5
0.99 0.9801 0.960596 0.9227448 0.8514579 0.7249806 0.5255968 0.276252

 (4;{x,x+/x+1})\:,0    / do function 4 times
,0                                         
0 1                                        
0 1 3 4                                    
0 1 3 4 12 13 15 16                        
0 1 3 4 12 13 15 16 72 73 75 76 84 85 87 88

 (10&gt;#;{x,x+/x+1})\:,0 / while output is less than 10 long
,0                                         
0 1                                        
0 1 3 4                                    
0 1 3 4 12 13 15 16                        
0 1 3 4 12 13 15 16 72 73 75 76 84 85 87 88

 x:3 4 2 1 4 99        / until output is x
 x\:0
0 3 1 4

 / the latter example worked out manually
 x 0
3
 x 3
1
 x 1
4
 x 4                   / x[4]=4 so will stop
4
</pre></div>



<hr>
<span id="Noun"></span><div class="header">
<p>
Next: <a href="#List" accesskey="n" rel="next">List</a>, Previous: <a href="#Adverb" accesskey="p" rel="prev">Adverb</a>, Up: <a href="#Top" accesskey="u" rel="up">Top</a> &nbsp; </p>
</div>
<span id="Noun-1"></span><h2 class="chapter">4 Noun</h2>
<p>The basic data types of the k9 language are booleans, numbers (integer and float), text (characters and enumerated/name) and temporal (date and time).  It is common to have functions operate on multiple data types.
</p>
<p>In additional to the basic data types, data can be put into lists (uniform, i.e., all elements of the same type, and non-uniform), dictionaries (key-value pairs), and tables (transposed/flipped dictionaries).  Dictionaries and tables will be covered in anohter chapter.
</p>
<p>Here are some examples of each of these types (note that 0N is a null integer and 0n a null float).
</p>
<div class="example">
<pre class="example">type              
<a href="#bool">bool</a> 011b
<a href="#int">int</a>  0N 0 2 3
<a href="#flt">flt</a>  0n 0 2 3.4   
<a href="#char">char</a> &quot; ab&quot;        
<a href="#name">name</a> ``ab         
<a href="#uuid">uuid</a>

<a href="#date">date</a> 2024.01.01
<a href="#time">time</a> 12:34:56.123456789
</pre></div>

<p>Data types can be determined by using the <code>@</code> function on values or lists of values.  In the case of non-uniform lists <code>@</code> returns the type of the list <code>`L</code> but the function can be modified to evaluate the type of each element in the list using <code>@'</code>.
</p>
<div class="example">
<pre class="example">&nbsp;@1            / integer atom
`i
&nbsp;@1 2 3        / integer list
`I
&nbsp;@12:34:56.789 / time atom
&nbsp;@(3;3.1;&quot;b&quot;;`a;12:01:02.123;2020.04.05) / mixed list
`L
&nbsp;@'(3;3.1;&quot;b&quot;;`a;12:01:02.123;2020.04.05)
`i`f`c`n`t`d
</pre></div>

<span id="Atom-Types"></span><span id="Atom-Types-1"></span><h3 class="section">4.1 Atom Types</h3>
<p>This section lists all the different types available.  Generally lower case specifies atoms and upper case as lists.
</p>
<table>
<tr><td width="10%"><b>name</b></td><td width="15%"><b>type</b></td><td width="45%"><b>example</b></td><td width="40%"><b>note</b></td></tr>
<tr><td width="10%"></td><td width="15%"></td><td width="45%"></td></tr>
<tr><td width="10%">b</td><td width="15%">boolean</td><td width="45%">1b</td><td width="40%"></td></tr>
<tr><td width="10%">c</td><td width="15%">character</td><td width="45%">&ldquo;a&rdquo;</td><td width="40%"></td></tr>
<tr><td width="10%">d</td><td width="15%">date</td><td width="45%">2020.06.14</td><td width="40%"></td></tr>
<tr><td width="10%">e</td><td width="15%">float</td><td width="45%">3.1</td><td width="40%"></td></tr>
<tr><td width="10%">f</td><td width="15%">float</td><td width="45%">3.1f</td><td width="40%"></td></tr>
<tr><td width="10%">g</td><td width="15%">int</td><td width="45%">2g</td><td width="40%">1 byte unsigned</td></tr>
<tr><td width="10%">h</td><td width="15%">int</td><td width="45%">2h</td><td width="40%">2 byte unsigned</td></tr>
<tr><td width="10%">i</td><td width="15%">int</td><td width="45%">2</td><td width="40%">4 byte unsigned</td></tr>
<tr><td width="10%">j</td><td width="15%">int</td><td width="45%">2j</td><td width="40%">8 byte signed</td></tr>
<tr><td width="10%">n</td><td width="15%">name</td><td width="45%"><em>`</em>abc</td><td width="40%">8 char max</td></tr>
<tr><td width="10%">s</td><td width="15%">time</td><td width="45%">12:34:56</td><td width="40%">second</td></tr>
<tr><td width="10%">S</td><td width="15%">datetime</td><td width="45%">2020.06.15T12:34:56</td><td width="40%">second</td></tr>
<tr><td width="10%">t</td><td width="15%">time</td><td width="45%">12:34:56.123</td><td width="40%">millisecond</td></tr>
<tr><td width="10%">T</td><td width="15%">datetime</td><td width="45%">2020.06.15T12:34:56.123</td><td width="40%">millisecond</td></tr>
<tr><td width="10%">u</td><td width="15%">time</td><td width="45%">12:34:56.123456</td><td width="40%">microsecond</td></tr>
<tr><td width="10%">U</td><td width="15%">datetime</td><td width="45%">2020.06.15T12:34:56.123456</td><td width="40%">microsecond</td></tr>
<tr><td width="10%">v</td><td width="15%">time</td><td width="45%">12:34:56.123456789</td><td width="40%">nanosecond</td></tr>
<tr><td width="10%">V</td><td width="15%">datetime</td><td width="45%">2020.06.15T12:34:56.123456789</td><td width="40%">nanosecond</td></tr>
</table>


<span id="bool"></span><span id="bool-_21d2-Boolean-b"></span><h3 class="section">4.2 bool &rArr; Boolean b</h3>
<p>Booleans have two possible values 0 and 1 and have a &rsquo;b&rsquo; to avoid confusion with integers, eg. 0b or 1b.
</p>
<div class="example">
<pre class="example">&nbsp;0b
0b
&nbsp;1b
1b
&nbsp;10101010b
10101010b
</pre></div>

<span id="boolean-logic"></span><h4 class="subsection">4.2.1 boolean logic</h4>
<p>k9 implements logic operations in the usual way.
</p>
<div class="example">
<pre class="example"> x:0101b;y:0011b

[[x:x;y:y]AND:x&amp;y;OR:x|y;NAND:~x&amp;y;NOR:~x|y;XOR:~x=y;XNOR:x=y]
x y|AND OR NAND NOR XOR XNOR
- -|--- -- ---- --- --- ----
0 0|  0  0    1   1   0    1
1 0|  0  1    1   0   1    0
0 1|  0  1    1   0   1    0
1 1|  1  1    0   0   0    1
</pre></div>

<span id="Numeric-Data"></span><h3 class="section">4.3 Numeric Data</h3>
<p>Numbers can be stored as integers and floats.
</p>
<span id="int"></span><span id="int-_21d2-Integer-g_002c-h_002c-i_002c-j"></span><h4 class="subsection">4.3.1 int &rArr; Integer g, h, i, j</h4>
<p>Integers can be stored in four different ways which correspond 1, 2, 4, and 8 bytes.  The first three are unsigned and the last (j) is signed.  Positive numbers default to i and negative and very large numbers default to j.  One can specify a non-default type by adding one of the four letters immediately following the number.
</p>
<div class="example">
<pre class="example"> @37    / will default to i
`i
 @-37   / negative so will default to j
`j

 @37g   / cast as g, one byte unsigned
`g

b:{-1+*/x#256}
 `g b[1]
255g
 `h b[2]
65535h
 `i b[4]
4294967295
 `j b[7]
72057594037927935
</pre></div>

<span id="flt"></span><span id="flt-_21d2-Float-e_002c-f"></span><h4 class="subsection">4.3.2 flt &rArr; Float e, f</h4>
<p>Float
</p><div class="example">
<pre class="example"> 3.1
3.1
 3.1+1.2
4.3
 3.1-1.1   
2.
 @3.1-1.1
`e
 @3.1
`e
 a:3.1;
 @a
`e
 @1%3
`f
</pre></div>

<span id="Text-Data"></span><h3 class="section">4.4 Text Data</h3>
<p>Text data come in characters, lists of characters (aka strings) and enumerated types.  Enumerated types are displayed as text but stored internally as integers.
</p>
<span id="char"></span><span id="char-_21d2-Character-c"></span><h4 class="subsection">4.4.1 char &rArr; Character c</h4>
<p>Characters are stored as their ANSI value and can be seen by conversion to integers.  A string is a list of characters (including blanks).
</p>
<div class="example">
<pre class="example">&nbsp;@&quot;b&quot;
`c
&nbsp;@&quot;bd&quot;
`C 
</pre></div>

<span id="name"></span><span id="name-_21d2-Name-n"></span><h4 class="subsection">4.4.2 name &rArr; Name n</h4>
<p>A name is an enumerated type displayed as a text string but stored internally as an integer value.
</p>
<div class="example">
<pre class="example">&nbsp;@`blue
`n
&nbsp;@`blue`red
`N
</pre></div>

<span id="Unique-Identifier"></span><h3 class="section">4.5 Unique Identifier</h3>
<p>TBD
</p>
<span id="uuid"></span><span id="uuid-_21d2-Uuid"></span><h4 class="subsection">4.5.1 uuid &rArr; Uuid</h4>
<p>TBD
</p>
<span id="Temporal-Data"></span><h3 class="section">4.6 Temporal Data</h3>
<p>Temporal data can be expressed as time, date, or a combined date and time.
</p>
<span id="time"></span><span id="time-_21d2-Time-s_002c-t_002c-u_002c-v"></span><h4 class="subsection">4.6.1 time &rArr; Time s, t, u, v</h4>
<p>Time has four types depending on the level of precision.  The types are seconds (s), milliseconds (t), microseconds (u), and nanoseconds (v).  The times are all stored internally as integers.  The integers are the number of time units.  For example 00:00:00.012 and 00:00:00.000000012 are both stored as 12 internally.
</p>
<div class="example">
<pre class="example"> @12:34:56.789             / time
`t
 .z.t                       / current time in GMT (Greenwich Mean Time)
17:32:57.995
 t: .z.t-17:30:00.000; t
00:03:59.986
 t
17:33:59.986
 `i 00:00:00.001            / numeric representation of 1ms
1
 `i 00:00:01.000            / numeric representation of 1s
1000
 `i 00:01:00.000            / numeric representation of 1m
60000
 `t 12345                   / convert number to milliseconds
00:00:12.345
</pre></div>

<span id="date"></span><span id="date-_21d2-Date-d"></span><h4 class="subsection">4.6.2 date &rArr; Date d</h4>
<p>Dates are in yyyy.mm.dd format.  Dates are stored internally as integers with 0 corresponding to 2001.01.01.
</p>
<div class="example">
<pre class="example"> @2020.04.20               / date
`d
 .z.d                       / current date in GMT
2020.12.05
 `i .z.d                    / numeric representation of date
7278
 `i 2001.01.01              / zero date
0
 `d 0                       / zero date
2001.01.01
</pre></div>

<span id="datetime"></span><span id="datetime-_21d2-Datetime-d"></span><h4 class="subsection">4.6.3 datetime &rArr; Datetime d</h4>
<p>Dates and times can be combined into a single datetime element by combining a date, the letter T, and the time together without spaces.  The datetime use the same lettering as the time precision but in uppercase.  Datetimes are stored interally as integers.  For example 2001.01.02T00:00:00.000 is stored as 86,400,000, the number of milliseconds in a day.
</p>
<div class="example">
<pre class="example"> @2020.04.20T12:34:56.789  / date and time
`d
 `T$&quot;2020.04.20 12:34:56.789&quot; / converting from string
2020.04.20T12:34:56.789
</pre></div>

<span id="Extreme-values"></span><h3 class="section">4.7 Extreme values</h3>
<p>Data types can represent in-range, null, and out-of-range values.
</p>
<table>
<tr><td width="15%"><b>type</b></td><td width="15%"><b>null</b></td><td width="20%"><b>out of range</b></td></tr>
<tr><td width="15%">i</td><td width="15%">0N</td><td width="20%">0W</td></tr>
<tr><td width="15%">f</td><td width="15%">0n</td><td width="20%">0w</td></tr>
</table>

<div class="example">
<pre class="example">&nbsp;0%0
0n
&nbsp;1e500
0w
</pre></div>

<hr>
<span id="List"></span><div class="header">
<p>
Next: <a href="#Dictionary" accesskey="n" rel="next">Dictionary</a>, Previous: <a href="#Noun" accesskey="p" rel="prev">Noun</a>, Up: <a href="#Top" accesskey="u" rel="up">Top</a> &nbsp; </p>
</div>
<span id="List-1"></span><h2 class="chapter">5 List</h2>
<p>Lists and derivatives of lists are fundamental to k9 which makes sense given that the language is made to process large quantites of data.  Performance will be best when working with uniform lists of a single data type but k9 supports list of non-uniform type also.
</p>
<p>Lists are automatically formed when a sequence of uniform type are entered or generated by any function.
</p>
<div class="example">
<pre class="example"> 1 3 12      / list of ints
1 3 12

 3.1 -4.1 5. / list of floats
3.1 -4.1 5.

 &quot;abc&quot;       / list of chars
&quot;abc&quot;

 `x`y`z      / list of names
`x`y`z
</pre></div>

<p>In order to determine if data is an atom or a list, one can use the <a href="#type">type</a> command.  The command returns a lower case value for atoms and an upper case value for lists.
</p>
<div class="example">
<pre class="example"> @1          / an integer
`i

@1 3 12     / list of ints
`I

@,1         / list of single int via <a href="#enlist">list</a>
`I
</pre></div>

<p>Commands that generate sequences of numbers return lists regardless of whether the count (length of the list) is 1 or many.
</p>
<div class="example">
<pre class="example"> @!0
`I
 @!1
`I
 @!2
`I
</pre></div>

<span id="List-Syntax"></span><h3 class="section">5.1 List Syntax</h3>
<p>In general, lists consist of elements separated by semicolons and encased by parenthesis.
</p>
<div class="example">
<pre class="example"> (1;3;12)         / list of ints
1 3 12

@(1;3.;`a;&quot;b&quot;)   / non-uniform list
`L

@((1;3);(12;0))  / list of integer lists
LI

@'((1;3);(12;0)) / each list is type I
`I`I

,,,,,(3;1)      / a list of a list of a list..
,,,,,3 1
</pre></div>

<span id="List-Indexing"></span><h3 class="section">5.2 List Indexing</h3>
<p>Lists can be indexed in different ways.  The @ notation is often used as it&rsquo;s fewer characters than [] and the explicit @ instead of space is likely more clear.
</p>
<div class="example">
<pre class="example"> a:2*1+!10 / 2 4 ... 20
 a[9]      / square bracket
20
 a@9       / at
20
 a 9       / space 
20
 a(9)      / parenthesis
20
 a[10]     / out of range return zero
0
</pre></div>

<span id="Updating-List-Elements"></span><h3 class="section">5.3 Updating List Elements</h3>
<p>Lists can be updated elementwise by  setting the indexed element to a required value.  There is also a syntax for updating many elements and that is found at <a href="#amend">amend</a>.
</p>
<div class="example">
<pre class="example"> a:2*1+!10;a
2 4 6 8 10 12 14 16 18 20
 a[3]:80
 a
2 4 6 80 10 12 14 16 18 20
</pre></div>

<span id="Function-Applied-to-Lists"></span><h3 class="section">5.4 Function Applied to Lists</h3>
<p>Most functions can be applied to lists without special syntax as if it was an element.
</p>
<div class="example">
<pre class="example"> x:!3;x
0 1 2

 x+10
10 11 12

 +\x
0 1 3

 +/x
3

 {x*x:sin x}[x]
0 0.7080734 0.8268218
</pre></div>

<span id="Functions-Applied-to-Two-Lists"></span><h3 class="section">5.5 Functions Applied to Two Lists</h3>
<p>This section will focus on functions (f) that operate on two lists (x and y).  As these are internal functions, examples will be shown with infix notation (x+y) but prefix notation (+[x;y]) would  also be possible.
</p>
<span id="Pairwise"></span><h4 class="subsection">5.5.1 Pairwise</h4>
<p>These functions operate on list elements pairwise and thus requires that x and y are equal length.
</p><ul>
<li> <tt>x+y : Add</tt>
</li><li> <tt>x-y : Subtract</tt>
</li><li> <tt>x*y : Multiply</tt>
</li><li> <tt>x%y : Divide</tt>
</li><li> <tt>x&amp;y : AND/Min</tt>
</li><li> <tt>x|y : OR/Max</tt>
</li><li> <tt>x&gt;y : Greater Than</tt>
</li><li> <tt>x&lt;y : Less Than</tt>
</li><li> <tt>x=y : Equals</tt>
</li><li> <tt>x!y : Dictionary</tt>
</li></ul>

<div class="example">
<pre class="example">&nbsp;x:1+!5; y:10-2*!5
&nbsp;x
1 2 3 4 5
&nbsp;y
10 8 6 4 2
&nbsp;x+y
11 10 9 8 7
&nbsp;x-y
-9 -6 -3 0 3
&nbsp;x*y
10 16 18 16 10
&nbsp;x%y
0.1 0.25 0.5 1 2.5f
&nbsp;x&amp;y
1 2 3 4 2
&nbsp;x|y
10 8 6 4 5
&nbsp;x&gt;y
00001b
&nbsp;x&lt;y
11100b
&nbsp;x=y
00010b
&nbsp;x!y
1|10
2| 8
3| 6
4| 4
5| 2
</pre></div>

<span id="Each-Element-of-One-List-Compared-to-Entire-Other-List"></span><h4 class="subsection">5.5.2 Each Element of One List Compared to Entire Other List</h4>
<p>These functions compare x[i] to y or x to y[i]. They are  not symmetric to their inputs, i.e. f[x;y] does not equal f[y;x];
</p>
<ul>
<li> <tt>x^y : Reshape all element in y by x</tt>
</li><li> <tt>x#y : List all elements in x that appear in y</tt>
</li><li> <tt>x?y : Indices of elements of y in x else return the length of x.</tt>
</li></ul>

<div class="example">
<pre class="example"> x:0 2 5 10
 y:!20
 x^y
0 1                          
2 3 4                        
5 6 7 8 9                    
10 11 12 13 14 15 16 17 18 19

 x:2 8 20
 y:1 2 3 7 8 9
 x#y
2 8
 x?y
3 0 3 3 1 3
</pre></div>

<span id="Each-List-Used-Symmetrically"></span><h4 class="subsection">5.5.3 Each List Used Symmetrically</h4>
<p>This is symmetric in its inputs f[x;y]=f[y;x] and the lists are not required to be equal length.
</p>
<ul>
<li> <tt>x_y : Values present in only one of the two lists</tt>
</li></ul>

<div class="example">
<pre class="example">&nbsp;x:2 8 20
&nbsp;y:1 2 3 7 8 9
&nbsp;x_y
1 3 7 9
</pre></div>


<hr>
<span id="Dictionary"></span><div class="header">
<p>
Next: <a href="#User-Functions" accesskey="n" rel="next">User Functions</a>, Previous: <a href="#List" accesskey="p" rel="prev">List</a>, Up: <a href="#Top" accesskey="u" rel="up">Top</a> &nbsp; </p>
</div>
<span id="Dictionary-1"></span><h2 class="chapter">6 Dictionary</h2>
<p>Dictionaries are a data type of key-value pairs typically used to retrieve the value by using the key.  In other computer languages they are also known as associative arrays and maps.  Keys should be unique to avoid lookup value confusion but uniqueness is not enforced.  The values in the dictionary can be single elements, lists, tables, or even other dictionaries.
</p>
<p>Dictionaries in k9 are often used.  As an example from finance, market quotes and trade data are dictionaries of symbols (name keys) and market data (table values).  
</p>
<span id="Dictionary-Creation-_21d2-x_0021y-or-_005bx_003by_005d"></span><h3 class="section">6.1 Dictionary Creation &rArr; x!y or [x;y]</h3>

<p>Dictionaries are created by using the key symbol or square bracket notation and listing the keys (x) and values (y).  
</p>
<p><code>x!y</code>
</p>
<div class="example">
<pre class="example"> d0:`a37!12; d0                          / key is `a37 and value is 12
a37|12

 d1:`pi`e`c!3.14 2.72 3e8;d1             / three keys `pi, `e, `c
pi|3.14 
e |2.72 
c |3e+08

 `a`b`c!(1 2 3;10 20 30;100 200 300 499) / values are lists
a|1 2 3      
b|10 20 30   
c|100 200 300 499
</pre></div>

<p><code>[x:y]</code>
</p>
<div class="example">
<pre class="example"> d0:[a37:12]
a37|12

 d1:[pi:3.14;e:2.72;c:3e8];d1
pi|3.14
e |2.72
c |3e+08

 [a:1 2 3;b:10 20 30;c:100 200 300]
a|1 2 3      
b|10 20 30   
c|100 200 300
</pre></div>

<p>Often one will need to modify the data while building the dictionary.  User defined functions can easily accomplish this task.
</p>
<div class="example">
<pre class="example"> `x`sinX`cosX!{(x;sin y;cos z)} . 3#,0.1*(!62)
x   |0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1 1.1 ..
sinX|0 0.09983342 0.1986693 0.2955202 0.3894183 0..
cosX|1 0.9950042 0.9800666 0.9553365 0.921061 0.8..

</pre></div>

<span id="Dictionary-Join-_21d2-x_002cy"></span><h3 class="section">6.2 Dictionary Join &rArr; x,y</h3>
<p>This joins dictionaries together and the right or y dictionary will overwrite the left or x dictionary if common keys are present.
</p>
<div class="example">
<pre class="example"> d1:`a`b`c!3 2 1;d1
a|3
b|2
c|1

 d2:`c`d`e!90 80 70;d2
c|90
d|80
e|70

 ^d1,d2 / ^ sort by key
a| 3
b| 2
c|90
d|80
e|70

 ^d2,d1 / ^ sort by key
a| 3
b| 2
c| 1
d|80
e|70
</pre></div>

<span id="Dictionary-Indexing-_21d2-x_0040y"></span><h3 class="section">6.3 Dictionary Indexing &rArr; x@y</h3>

<p>Dictionaries, like lists, can be key indexed in a number of ways.
</p>
<div class="example">
<pre class="example"> x:`a`b`c!(1 2;3 4;5 6);x
a|1 2
b|3 4
c|5 6

x@`a   / single index     
1 2

x@`a`c / multiple index   
1 2
5 6

/ all these notations for indexing work (output not shown)
 x@`b;  / at
 x(`b); / parenthesis
 x `b;  / space
 x[`b]; / square bracket
</pre></div>

<span id="Dictionary-Key-_21d2-_0021x"></span><h3 class="section">6.4 Dictionary Key &rArr; !x</h3>
<p>The keys from a dictionary are retreived by using the ! function.
</p>
<div class="example">
<pre class="example">&nbsp;!d0
`pi`e`c
&nbsp;!d1
`time`temp
&nbsp;!d2
0 10 1
</pre></div>

<span id="Dictionary-Value-_21d2-x_005b_005d"></span><h3 class="section">6.5 Dictionary Value &rArr; x[]</h3>
<p>The values from a dictionary are retrieved using bracket notation.
</p>
<div class="example">
<pre class="example"> d0[]
3.14 2.72 3e+08
 d1[]
12:00 12:01 12:10
25.   25.1  25.6 

 d2[]
37.4 46.3 0.1
</pre></div>

<p>One could return a specific value by indexing into a specific location.  As an example, in order to query the first value of the values associated with the key temp from d1, one would convert d1 into values (a pair of lists), and index that by [1;0]. 
</p>
<div class="example">
<pre class="example">&nbsp;d1
time|12:00 12:01 12:10
temp|25 25.1 25.6     

&nbsp;d1[]
12:00 12:01 12:10
25    25.1  25.6 

&nbsp;d1[][1]
25 25.1 25.6
&nbsp;d1[][1;0]
25.
</pre></div>

<span id="Sorting-a-Dictionary-by-Key-_21d2-_005ex"></span><h3 class="section">6.6 Sorting a Dictionary by Key &rArr; ^x</h3>

<div class="example">
<pre class="example">&nbsp;d0
pi|3.14 
e |2.72 
c |3e+08

&nbsp;^d0
c |3e+08
e |2.72 
pi|3.14 
</pre></div>

<span id="Sorting-a-Dictionary-by-Value-_21d2-_003cx-_0028_003ex_0029"></span><h3 class="section">6.7 Sorting a Dictionary by Value &rArr; &lt;x (&gt;x)</h3>

<div class="example">
<pre class="example">&nbsp;d0
pi|3.14 
e |2.72 
c |3e+08

&nbsp;&lt;d0
e |2.72 
pi|3.14 
c |3e+08

&nbsp;&gt;d0
c |3e+08
pi|3.14 
e |2.72 
</pre></div>

<span id="Flipping-a-Dictionary-into-a-Table-_21d2-_002bx"></span><h3 class="section">6.8 Flipping a Dictionary into a Table &rArr; +x</h3>
<p>This command flips a dictionary into a table and will be covered in detail in the table chapter.
</p>
<div class="example">
<pre class="example"> d1
time|12:00 12:01 12:10
temp|25 25.1 25.6     

 +d1
time  temp
----- ----
12:00 25  
12:01 25.1
12:10 25.6

 d1~+d1
0b
</pre></div>

<span id="Functions-that-operate-on-each-value-in-a-dictionary"></span><h3 class="section">6.9 Functions that operate on each value in a dictionary</h3>
<p>There are a number of simple functions on dictionaries that operate on their values.  If &rsquo;f&rsquo; is a function then f applied to a dictionary returns a dictionary with the same keys and the values resulting from the application of &rsquo;f&rsquo;.
</p>
<ul>
<li> <tt>-d : Negate</tt>
</li><li> <tt>d + N : Add N to d</tt>
</li><li> <tt>d - N : Subtract N from d</tt>
</li><li> <tt>d * N : Multiple d by N</tt>
</li><li> <tt>d % N : Divide d by N</tt>
</li><li> <tt>|d : Reverse</tt>
</li><li> <tt>&lt;d : Sort Ascending</tt>
</li><li> <tt>&gt;d : Sort Descending</tt>
</li><li> <tt>~d : Not d</tt>
</li><li> <tt>&amp;d : Given d:x!y output each x, y times, where y must be an integer</tt>
</li><li> <tt>=d : Given d:x!y y!x</tt>
</li></ul>

<p>Examples
</p><div class="example">
<pre class="example">&nbsp;d2
&nbsp;0|37.4
10|46.3
&nbsp;1|0.1 

&nbsp;-d2
&nbsp;0|-37.4
10|-46.3
&nbsp;1|-0.1 

&nbsp;d2+3
&nbsp;0|40.4
10|49.3
&nbsp;1|3.1 

&nbsp;d2-1.7
&nbsp;0|35.7
10|44.6
&nbsp;1|-1.6

&nbsp;d2*10
&nbsp;0|374
10|463
&nbsp;1|1  

&nbsp;d2%100
&nbsp;0|0.374
10|0.463
&nbsp;1|0.001
</pre></div>

<span id="Functions-that-return-over-values-from-a-dictionary"></span><h3 class="section">6.10 Functions that return over values from a dictionary</h3>
<p>There are functions on dictionaries that operate over the values.  Given function f applied to a dictionary d, f d returns one or more values  without the original keys.
</p>
<ul>
<li> *d : First value
</li></ul>
<div class="example">
<pre class="example">&nbsp;d0
pi|3.14
e |2.72
c |3e+08

&nbsp;*d0
3.14
</pre></div>

<hr>
<span id="User-Functions"></span><div class="header">
<p>
Next: <a href="#Expression" accesskey="n" rel="next">Expression</a>, Previous: <a href="#Dictionary" accesskey="p" rel="prev">Dictionary</a>, Up: <a href="#Top" accesskey="u" rel="up">Top</a> &nbsp; </p>
</div>
<span id="User_002ddefined-Functions"></span><h2 class="chapter">7 User-defined Functions</h2>
<p>User-defined functions are treated as verbs in k9, so can benefit from the adverbs.
</p>
<p>Multi-line functions must be defined with an initial space on all lines except the first.  These can be loaded into memory by using the <a href="#load">\l</a> command and then used by calling by name.
</p>
<div class="example">
<pre class="example">Func {[a;b]a+b}
</pre></div>

<span id="Function-arguments"></span><h3 class="section">7.1 Function arguments</h3>
<p>Functions default to arguments of x, y, and z for the first three parameters but one  can  explicitly spell out these or other argument names.  Given k9&rsquo;s terseness, many k9 programmers prefer short variable names. But this is a matter of taste.
</p>
<div class="example">
<pre class="example"> f1:{x+2*y}         / implicit arguments x and y
 f1[2;10]
22

 f2:{[x;y]x+2*y}    / explicit
 f2[2;10]
22

 f3:{[g;h]g+2*h}    / explicit arguments other than x and y
 f3[2;10]
22

 f4:{[please;dont]please+2*dont} / longer argument names are possible
 f4[2;10]
22

 @f1
`.
</pre></div>

<span id="Function-Defitions"></span><h3 class="section">7.2 Function Defitions</h3>
<p>Functions can have intermediate calcuations and local variables.  Function local variables do not affect the values of  global variables.
</p>
<div class="example">
<pre class="example"> a:3;a
3

 f:{a:12;x:sqrt x;x+a}

 f 10
15.16228

a
3
</pre></div>

<span id="Function-Return"></span><h3 class="section">7.3 Function Return</h3>
<p>Function return the last value in the definition unless the definition ends with a semicolon in which case the function returns nothing.
</p>
<div class="example">
<pre class="example"> f:{x+2;};f 10  / returns nothing because of final semi-colon

 f:{x+2;27};f 10  / returns the last value which is 27
27

 f:{x+2};f 10
12
</pre></div>

<span id="Calling-functions"></span><h3 class="section">7.4 Calling functions</h3>
<p>Functions, like lists, can be called in a variety of ways.  Typically one uses square bracket notation when the function takes multiple argruments.  If a function is called with fewer than the required number of arguments then it will return a function that requires the remaining arguemnts.
</p>
<div class="example">
<pre class="example"> f1:{[x] x}
 f2:{[x;y](x;y)}
 f3:{[x;y;z](x;y;z)}
 
 f1[`a]
`a

 f2[37;`a]
37
a 

 f3[&quot;hi&quot;;37;`a]
hi
37
a 

 f2[37]     
{[x;y](x;y)}[37]
 f2[;`a]
{[x;y](x;y)}[;`a]

 f1[`a]
`a
 f1 `a
`a
 f1@`a
`a
</pre></div>

<span id="Anonymous-functions"></span><h3 class="section">7.5 Anonymous functions</h3>
<p>It&rsquo;s possible to define a function without naming it. If the function is to be used in just one place, this can make sense.
</p>
<div class="example">
<pre class="example"> {x+2*y}[2;10]
22
</pre></div>

<span id="Recursive-functions"></span><h3 class="section">7.6 Recursive functions</h3>
<p>k9 allows one to define a function which calls itself.  Care should be taken to avoid an infinite loop.
</p>
<div class="example">
<pre class="example"> f:{$[x&gt;1;x*f@x-1;1]};f 5
120
</pre></div>

<span id="Chained-functions"></span><h3 class="section">7.7 Chained functions</h3>
<p>It may be necessary to define a function to call a function without specifying arguments.  Imagine this trivial case.
</p>
<div class="example">
<pre class="example"> fa:{!x}
 fb:{x+2} fa
{x+2}
^
:rank
</pre></div>

<p>In order to succeed fa needs to have an <code>@</code> in the definition of fb.  This is required because fb calls fa without specifying an argument for fa. So the argument for fb becomes the argument for fa so the net effect is 2 + !3.
</p>
<div class="example">
<pre class="example"> fa:{!x}
 fb:{x+2} fa@
 fb 3
2 3 4
</pre></div>

<hr>
<span id="Expression"></span><div class="header">
<p>
Next: <a href="#Named-Functions" accesskey="n" rel="next">Named Functions</a>, Previous: <a href="#User-Functions" accesskey="p" rel="prev">User Functions</a>, Up: <a href="#Top" accesskey="u" rel="up">Top</a> &nbsp; </p>
</div>
<span id="Expression-Evaluation"></span><h2 class="chapter">8 Expression Evaluation</h2>
<p>k9 has a compact way to evaluate expressions on dictionaries.  This allows one to use the dictionary keys as local variables to get to results with less code.
</p>
<pre class="verbatim">Expr :a+b
</pre>
<span id="expr-_21d2-x-_003ay"></span><h3 class="section">8.1 expr &rArr; x :y</h3>
<p>Evaluate expression(s) <code>y</code> on table or dictionary <code>x</code>.  The space between <code>x</code> and <code>:</code> is required otherwise it becomes <a href="#set">set</a>, i.e., assignment.
</p>
<div class="example">
<pre class="example"> d:[city:`Chongqing`Shanhai`Beijing`Delhi`Chengdu]; d
city|`Chongqin`Shanhai`Beijing`Delhi`Chengdu

 d,:[country:`cn`cn`cn`in`cn;size:30 24 22 17 16] ; d
city   |`Chongqin`Shanhai`Beijing`Delhi`Chengdu
country|`cn`cn`cn`in`cn                        
size   |30 24 22 17 16                         

 d :&amp;country=`in       / using country like a local variable
,3

 d :sum'size@=country  / sum size by country
cn|92
in|17

 d :+/size*country=`cn
92
</pre></div>

<p>As keys come in scope as variables, variables fall out of scope.  One can evaluate the variable name as string to get around this.
</p>
<div class="example">
<pre class="example"> d :sum size@&amp;size&gt;20
76

 x:20;
 d :sum size@&amp;size&gt;x  / out of scope
!value

 d :sum size@&amp;size&gt;.&quot;x&quot;
76
</pre></div>

<p>Reorder a table using column index and expresssions.
</p>
<div class="example">
<pre class="example"> t:[[]x:`b`a`c;y:1 3 2];t
x y
- -
b 1
a 3
c 2

 t@&lt;t :y
x y
- -
b 1
c 2
a 3

 t@&lt;t`y
x y
- -
b 1
c 2
a 3
</pre></div>

<hr>
<span id="Named-Functions"></span><div class="header">
<p>
Next: <a href="#Knit-Functions" accesskey="n" rel="next">Knit Functions</a>, Previous: <a href="#Expression" accesskey="p" rel="prev">Expression</a>, Up: <a href="#Top" accesskey="u" rel="up">Top</a> &nbsp; </p>
</div>
<span id="Named-Functions-1"></span><h2 class="chapter">9 Named Functions</h2>
<p>This chapter covers the built-in  named functions.  This includes some math (eg. sqrt but not +), wrapper (eg. count for #) and range (eg. within) functions.
</p>

<p>rand has bin in within div mod bar rand cmb msum mavg
count first last sum min max *[avg var dev med ..]; key meta
</p>

<div class="format">
<div class="example">
<pre class="example"><a href="#exp">exp</a> <a href="#log">log</a> <a href="#sin">sin</a> <a href="#cos">cos</a> <a href="#sqr">sqr</a> <a href="#sqrt">sqrt</a> <a href="#prm">prm</a> <a href="#freq">freq</a> <a href="#sums">sums</a> <a href="#deltas">deltas</a>
<a href="#rand">rand</a> <a href="#has">has</a> <a href="#bin">bin</a> <a href="#in">in</a> <a href="#within">within</a> <a href="#div">div</a> <a href="#mod">mod</a> <a href="#bar">bar</a> <a href="#cmb">cmb</a> <a href="#msum">msum</a> <a href="#mavg">mavg</a>
<a href="#Hcount">count</a> <a href="#Hfirst">first</a> <a href="#Hlast">last</a> <a href="#Hsum">sum</a> <a href="#Hmin">min</a> <a href="#Hmax">max</a>
</pre></div>
</div>

<span id="exp"></span><span id="exp-_21d2-exp-x"></span><h3 class="section">9.1 exp &rArr; exp x</h3>
<p>exp compute the exponent of x, i.e. e<sup>x</sup>.
</p>
<div class="example">
<pre class="example">&nbsp;exp 1
2.718282
</pre></div>

<span id="log"></span><span id="log-_21d2-log-x"></span><h3 class="section">9.2 log &rArr; log x</h3>
<p>Log computes the natural log.
</p>
<div class="example">
<pre class="example">&nbsp;log 10
2.302585
</pre></div>

<span id="sin"></span><span id="sin-_21d2-sin-x"></span><h3 class="section">9.3 sin &rArr; sin x</h3>
<p>sin computes the sine of x where x is in radians.
</p><div class="example">
<pre class="example">&nbsp;sin 0
0f
&nbsp;sin 3.1416%2
1.
</pre></div>

<span id="cos"></span><span id="cos-_21d2-cos-x"></span><h3 class="section">9.4 cos &rArr; cos x</h3>
<p>cos computes the cosine of x where x is in radians.
</p><div class="example">
<pre class="example">&nbsp;cos 0
1f
&nbsp;cos 3.1416%4
0.7071055
</pre></div>

<span id="sqr"></span><span id="sqr-_21d2-sqr-x"></span><h3 class="section">9.5 sqr &rArr; sqr x</h3>
<p>Compute the square of x.
</p>
<div class="example">
<pre class="example">&nbsp;sqr 2
4.0
</pre></div>

<span id="sqrt"></span><span id="sqrt-_21d2-sqrt-x"></span><h3 class="section">9.6 sqrt &rArr; sqrt x</h3>
<p>Compute the square root of x.
</p>
<div class="example">
<pre class="example">&nbsp;sqrt 2
1.414214
</pre></div>

<span id="prm"></span><span id="prm-_21d2-prm-x"></span><h3 class="section">9.7 prm &rArr; prm x</h3>
<p>Write out all permutations of integers up x-1. Display them as columns.
</p>
<div class="example">
<pre class="example"> prm 3
0 1 1 0 2 2
1 0 2 2 0 1
2 2 0 1 1 0
</pre></div>

<span id="freq"></span><span id="freq-_21d2-freq-x"></span><h3 class="section">9.8 freq &rArr; freq x</h3>
<p>Compute the frequency of the items in list x.
</p>
<div class="example">
<pre class="example"> freq &quot;abzccdefeajfekjrlke&quot;
a|2
b|1
c|2
d|1
e|4
f|2
j|2
k|2
l|1
r|1
z|1

 freq 1000 rand 10
0| 95
1|106
2| 84
3| 98
4|109
5|104
6| 94
7| 95
8|120
9| 95
</pre></div>

<span id="sums"></span><span id="sums-_21d2-sums-x"></span><h3 class="section">9.9 sums &rArr; sums x</h3>
<p>Compute the running sum of list x.  Sames as <code>+\</code>.
</p>
<div class="example">
<pre class="example"> sums !10
0 1 3 6 10 15 21 28 36 45
</pre></div>

<span id="deltas"></span><span id="deltas-_21d2-deltas-x-and-x-deltas-y"></span><h3 class="section">9.10 deltas &rArr; deltas x and x deltas y</h3>
<p>Compute the difference between each element in list x and the previous value.  If delta is called with two parameters then x will be used as the first value to delta instead of the default 0.
</p>
<div class="example">
<pre class="example"> deltas 1 5 10
1 4 5

 1 deltas 1 5 10
0 4 5
</pre></div>

<span id="rand"></span><span id="rand-_21d2-rand-x-or-x-rand-y"></span><h3 class="section">9.11 rand &rArr; rand x or x rand y</h3>
<p>Generate x random values using a uniform distribution from [0,1) or -x random values of a normal distribution (mean=0, standard deviation=1).
</p>
<div class="example">
<pre class="example"> rand 5  / uniform
0.9722755 0.8904738 0.4088624 0.1399796 0.1334422

 rand -5 / normal
1.008461 0.6204548 -1.206095 -0.7168573 -0.5728272
</pre></div>

<p>Generate x random values from element or list y.  For element y, y is the exclusive upper bound (int, float, date, or time), the type (character), or the length of each element (name).  For list y, rand choose between elements of the list.
</p>
<div class="example">
<pre class="example"> 5 rand 10 / values between 0 and 9
3 0 0 7 8

 4 rand &quot;a&quot; / values between &quot;A&quot; and &quot;P&quot;
&quot;OGFN&quot;

 4 rand `3 / name of length 3 using letters between &quot;A&quot; and &quot;P&quot;
`BFH`HKH`LOO`DAC

 5 rand 1 2
1 2 2 1 1

5 rand &quot;xy&quot;
&quot;yxxxy&quot;
</pre></div>

<span id="has"></span><span id="has-_21d2-x-has-y"></span><h3 class="section">9.12 has &rArr; x has y</h3>
<p>Determine whether vector x has element y. Simliar to <a href="#in">in</a> but with the arguments reversed.
</p>
<div class="example">
<pre class="example"> `a`b`c`a`b has `a
1b

`a`b`c`a`b has `d
0b

 `a`b`c`a`b has `a`b`x`y`z
11000b

 (1 2;4 5 6;7 9)has(1 2;8 9)
10b
</pre></div>

<span id="bin"></span><span id="bin-_21d2-x-bin-y"></span><h3 class="section">9.13 bin &rArr; x bin y</h3>
<p>Given a sorted (increasing) list x, find the greatest index, i, where y&gt;x[i].
</p>
<div class="example">
<pre class="example">&nbsp;n:exp 0.01*!5;n
1 1.01005 1.020201 1.030455 1.040811
&nbsp;1.025 bin n
2
</pre></div>

<span id="in"></span><span id="in-_21d2-x-in-y"></span><h3 class="section">9.14 in &rArr; x in y</h3>
<p>Determine if x is in list y.  Similar to <a href="#has">has</a> but arguments reversed.
</p>
<div class="example">
<pre class="example">&nbsp;`b in `a`b`d`e
1b
&nbsp;`c in `a`b`d`e
0b
</pre></div>

<span id="within"></span><span id="within-_21d2-x-within-y"></span><h3 class="section">9.15 within &rArr; x within y</h3>
<p>Test if x is equal to or greater than y[0] and less than y[1].
</p>
<div class="example">
<pre class="example"> 3 within 0 12
1b

0 within 0 12
1b

12 within 0 12
0b

23 within 0 12
0b
</pre></div>

<span id="div"></span><span id="div-_21d2-x-div-y"></span><h3 class="section">9.16 div &rArr; x div y</h3>
<p>y divided by x using integer division, taking the floor of the result.  x and y must be integers.
</p>
<div class="example">
<pre class="example">&nbsp;2 div 7
3
&nbsp;5 div 22
4
</pre></div>

<span id="mod"></span><span id="mod-_21d2-x-mod-y"></span><h3 class="section">9.17 mod &rArr; x mod y</h3>
<p>The remainder after y divided by x using integer division.  x and y must be integers.
</p>
<div class="example">
<pre class="example">&nbsp;12 mod 27
3
&nbsp;5 mod 22
2
</pre></div>

<span id="bar"></span><span id="bar-_21d2-x-bar-y"></span><h3 class="section">9.18 bar &rArr; x bar y</h3>
<p>For each value in y determine the maximum multiple of x that is less than or equal to each y.
</p>
<div class="example">
<pre class="example">&nbsp;10 bar 9 10 11 19 20 21
0 10 10 10 20 20
</pre></div>

<span id="cmb"></span><span id="cmb-_21d2-x-cmb-y"></span><h3 class="section">9.19 cmb &rArr; x cmb y</h3>
<p>Determine all x value combinations up to y. In this case these are ordered in ascending order from left to right.
</p>
<div class="example">
<pre class="example"> 3 cmb 5
2 3 4
1 3 4
1 2 4
1 2 3
0 3 4
0 2 4
0 2 3
0 1 4
0 1 3
0 1 2

 `a`b`c`d`e@3 cmb 5
`c`d`e
`b`d`e
`b`c`e
`b`c`d
`a`d`e
`a`c`e
`a`c`d
`a`b`e
`a`b`d
`a`b`c
</pre></div>

<span id="msum"></span><span id="msum-_21d2-x-msum-y"></span><h3 class="section">9.20 msum &rArr; x msum y</h3>
<p>Compute the length x  moving sum of list y.
</p>
<div class="example">
<pre class="example"> 3 msum !10
0 1 3 6 9 12 15 18 21 24
</pre></div>


<span id="mavg"></span><span id="mavg-_21d2-x-mavg-y"></span><h3 class="section">9.21 mavg &rArr; x mavg y</h3>
<p>Compute the length x  moving average of list y.
</p>
<div class="example">
<pre class="example"> 3 mavg !10
0 0.3333333 1 2 3 4 5 6 7 8
</pre></div>

<span id="Hcount"></span><span id="count-_21d2-count-x"></span><h3 class="section">9.22 count &rArr; count x</h3>
<p>Same as <a href="#count">count</a>.
</p>
<div class="example">
<pre class="example"> count 5 1 2
3
</pre></div>

<span id="Hfirst"></span><span id="first-_21d2-first-x"></span><h3 class="section">9.23 first &rArr; first x</h3>
<p>Same as <a href="#first">first</a>.
</p>
<div class="example">
<pre class="example"> first 5 1 2
5
</pre></div>

<span id="Hlast"></span><span id="last-_21d2-last-x"></span><h3 class="section">9.24 last &rArr; last x</h3>
<p>Retrieve the last element of list x.
</p>
<div class="example">
<pre class="example"> last 5 1 2
2
</pre></div>

<span id="Hsum"></span><span id="sum-_21d2-sum-x"></span><h3 class="section">9.25 sum &rArr; sum x</h3>
<p>Compute the sum of list x.  Same as <code>+/</code>.
</p>
<div class="example">
<pre class="example"> sum 5 1 2
8
</pre></div>
<span id="Hmin"></span><span id="min-_21d2-min-x"></span><h3 class="section">9.26 min &rArr; min x</h3>
<p>Retrieve the minimum element of list x.  Same as <code>|/</code>.
</p>
<div class="example">
<pre class="example"> min 5 1 2
1
</pre></div>

<span id="Hmax"></span><span id="max-_21d2-max-x"></span><h3 class="section">9.27 max &rArr; max x</h3>
<p>Retrieve the maximum element of list x.  Same as <code>&amp;/</code>.
</p>
<div class="example">
<pre class="example"> max 5 1 2
5
</pre></div>

<span id="topX"></span><span id="top-_21d2-top-x"></span><h3 class="section">9.28 top &rArr; top x</h3>
<p>Return the index of the max value of list x.
</p>
<div class="example">
<pre class="example"> top 3 13 15 1 17 0 -3
4

top &quot;abzccdefeajfekjrlke&quot;
2
</pre></div>

<span id="keyF"></span><span id="key-_21d2-x-key-y"></span><h3 class="section">9.29 key &rArr; x key y</h3>
<p>Key table y with x. That is, the values in the x column become the key values.
</p>
<div class="example">
<pre class="example"> `a key [[]a:`fa`fb;b:1 2]
a |b
--|-
fa|1
fb|2

 `a key [[]a:`fa`fb;b:((1 2 3); (4 5 6))]
a |b    
--|-----
fa|1 2 3
fb|4 5 6
</pre></div>

<span id="unkey"></span><span id="unkey-_21d2-unkey-x"></span><h3 class="section">9.30 unkey &rArr; unkey x</h3>
<p>Remove key from table x.
</p>
<div class="example">
<pre class="example"> unkey [[a:`x`y]b:1 2]
a b
- -
x 1
y 2
</pre></div>

<span id="meta"></span><span id="meta-_21d2-meta"></span><h3 class="section">9.31 meta &rArr; meta</h3>
<p>Determine the types of the fields in a table.
</p>
<div class="example">
<pre class="example"> meta [[]a:`x`y;b:1 2]
a|n
b|i
</pre></div>

<hr>
<span id="Knit-Functions"></span><div class="header">
<p>
Next: <a href="#I_002fO" accesskey="n" rel="next">I/O</a>, Previous: <a href="#Named-Functions" accesskey="p" rel="prev">Named Functions</a>, Up: <a href="#Top" accesskey="u" rel="up">Top</a> &nbsp; </p>
</div>
<span id="Knit-Functions-1"></span><h2 class="chapter">10 Knit Functions</h2>
<p>These functions modify lists and dictionaries given a list of indices and functions or values to replace.
</p>
<div class="example">
<pre class="example">@[r;i;f[;y]] <a href="#amend">amend</a>
.[r;i;f[;y]] <a href="#dmend">dmend</a>
</pre></div>

<span id="amend"></span><span id="amend-_21d2-_0040_005br_003bi_003bf_005b_003by_005d_005d"></span><h3 class="section">10.1 amend &rArr; @[r;i;f[;y]]</h3>
<p>Replace the values in list / dictionary r at indices i with element f or function f and parameter y.  The original list is not modified.  Indices are rows for lists and keys for dictionaries.
</p>
<table>
<tr><td><b>action</b></td><td><b>f</b></td><td><b>y</b></td></tr>
<tr><td><a href="#amend1">amend with element</a></td><td>element</td><td>n/a</td></tr>
<tr><td><a href="#amend2">amend with element/array</a></td><td>:</td><td>element/list</td></tr>
<tr><td><a href="#amend3">amend with function 1 param</a></td><td>function</td><td>n/a</td></tr>
<tr><td><a href="#amend4">amend with function 2 param</a></td><td>function</td><td>2nd param</td></tr>
</table>

<span id="amend1"></span><p>Amend to element.
</p>
<div class="example">
<pre class="example"> r:(0 1;2 3;4 5;6);r
0 1
2 3
4 5
6  

 @[r;0 3;29]      / change the first and fourth rows
29 
2 3
4 5
29 

 r               / r doesn't change
0 1
2 3
4 5
6  
</pre></div>

<span id="amend2"></span><p>Amend with element/array.  If using an array, then the <code>i</code> and <code>y</code> must be arrays of equal length.
</p>
<div class="example">
<pre class="example"> r:(0 1;2 3;4 5;6);r
0 1
2 3
4 5
6  

 @[r;1 2;:;(0;3 5)]
0 1
0  
3 5
6  
</pre></div>

<span id="amend3"></span><p>Amend with function f[r] at indices i.
</p>
<div class="example">
<pre class="example"> r:(0 1;2 3;4 5;6);r
0 1
2 3
4 5
6  

 @[r;1 2;sqrt]
0 1              
1.414214 1.732051
2.0 2.236068     
6

 d:[x:`a`b`c;y:9 4 1];d / dictionary example
x|`a`b`c
y|9 4 1 

 @[d;`y;sqrt]
x|`a`b`c
y|3 2 1.
</pre></div>

<span id="amend4"></span><p>Amend with function f[r;y] at indices i.
</p>
<div class="example">
<pre class="example"> r:(0 1;2 3;4 5;6);r
0 1
2 3
4 5
6  

 @[r;1 2;*;10 100]
0 1    
20 30  
400 500
6      

 d:[x:`a`b`c;y:9 4 1];d / dictionary
x|`a`b`c
y|9 4 1 

 @[d;`y;*;10]
x|`a`b`c  
y|90 40 10
</pre></div>

<span id="dmend"></span><span id="dmend-_21d2-_002e_005br_003bi_003bf_005b_003by_005d_005d"></span><h3 class="section">10.2 dmend &rArr; .[r;i;f[;y]]</h3>
<p>Similar to <a href="#amend">amend</a> but using <code>i</code> to fully index <code>r</code>.
</p>
<table>
<tr><td><b>action</b></td><td><b>f</b></td><td><b>y</b></td></tr>
<tr><td><a href="#dmend1">dmend with element</a></td><td>element</td><td>n/a</td></tr>
<tr><td><a href="#dmend3">dmend with function 1 param</a></td><td>function</td><td>n/a</td></tr>
<tr><td><a href="#dmend4">dmend with function 2 param</a></td><td>function</td><td>2nd param</td></tr>
</table>

<span id="dmend1"></span><p>Dmend to element.
</p>
<div class="example">
<pre class="example"> r:(0 1;2 3;4 5;6);r
0 1
2 3
4 5
6  

 .[r;0 1;12]       / modify the entry at [0;1]
0 12
2 3 
4 5 
6   
</pre></div>

<span id="dmend3"></span><p>Dmend with function f[r] at indices i.
</p>
<div class="example">
<pre class="example"> r:(0 1;2 3;4 5;6);r
0 1
2 3
4 5
6  

 .[r;1 1;sqrt]
0 1         
2.0 1.732051
4 5         
6           
</pre></div>

<span id="dmend4"></span><p>Dmend with function f[r;y] at indices i.
</p>
<div class="example">
<pre class="example"> r:(0 1;2 3;4 5;6);r
0 1
2 3
4 5
6  

 .[r;1 1;+;100]
0 1  
2 103
4 5  
6    
</pre></div>

<hr>
<span id="I_002fO"></span><div class="header">
<p>
Next: <a href="#Tables" accesskey="n" rel="next">Tables</a>, Previous: <a href="#Knit-Functions" accesskey="p" rel="prev">Knit Functions</a>, Up: <a href="#Top" accesskey="u" rel="up">Top</a> &nbsp; </p>
</div>
<span id="I_002fO-and-Interface"></span><h2 class="chapter">11 I/O and Interface</h2>
<p>In order to support fast data analysis, k9 supports fast input and output (I/O).  If you have the habit of making tea while a huge csv file loads, you might have to opt to take a few sips from a glass of water instead.
</p>
<p>k9 is also able to interface with other languages so one doesn&rsquo;t need to translate everything you&rsquo;ve already written in those
other languages to k9.
</p>
<div class="example">
<pre class="example"> I/O(*enterprise)
 0: <a href="#r-line">r</a>/<a href="#w-line">w</a> line
 1: <a href="#r-byte">r</a>/<a href="#w-byte">w</a> byte
*2: <a href="#r-data">r</a>/<a href="#w-data">w</a> data
*3: <a href="#k_002dipc-set">k-ipc set</a>    
*4: <a href="#https-get">https get</a>
*5: <a href="#ffi_002fpy_002fjs_002f_002e_002e">ffi/py/js/..</a>

<a href="#read-json">`js?</a><a href="#write-json">`js</a> d
<a href="#read-csv">`csv?</a><a href="#write-csv">`csv</a> t
</pre></div>

<span id="Example-of-Data-I_002fO"></span><h3 class="section">11.1 Example of Data I/O</h3>
<p>Let&rsquo;s begin with a simple example to show how to read data from a csv file.  We&rsquo;ll generate a small table and save it with and without headers (wHeader.csv and woHeader.csv respectively).  Then we&rsquo;ll read it back in, both specifying types and with the csv reader.  Types are specifed by one letter and the full list can be found in <a href="#Atom-Types">Atom Types</a>.
</p>
<div class="example">
<pre class="example"> t:[[]a:3 2 1;b:1. 2. 4.;c:`x`y`z];t / generate table
a b  c
- -- -
3 1. x
2 2. y
1 4. z

 &quot;wHeader.csv&quot;1:`csv t               / save with column headers
wHeader.csv

 &quot;woHeader.csv&quot;1:1_`csv t             / save without col headers
woHeader.csv

 `csv?1:&quot;wHeader.csv&quot;                 / default reader
a b  c
- -- -
3 1. x
2 2. y
1 4. z

 (&quot;,&quot;;&quot;ifn&quot;)1:&quot;wHeader.csv&quot;          / separator and types
a b  c
- -- -
3 1. x
2 2. y
1 4. z

 (`e`f`g;&quot;,&quot;;&quot;ifn&quot;)0:&quot;woHeader.csv&quot;  / names, separator and types
e f  g
- -- -
3 1. x
2 2. y
1 4. z
</pre></div>

<span id="read-csv"></span><span id="read-csv-_21d2-_0060csv_003fx"></span><h3 class="section">11.2 read csv &rArr; <em>`</em>csv?x</h3>
<p>Convert x from csv format.  Works on lists and tables.  You can also use <em>`</em>cs.
</p>
<div class="example">
<pre class="example"> `csv?(&quot;a,b&quot;;&quot;1,3.&quot;;&quot;2,4.&quot;)
a b 
- --
1 3.
2 4.
</pre></div>

<span id="write-csv"></span><span id="write-csv-_21d2-_0060csv-x"></span><h3 class="section">11.3 write csv &rArr; <em>`</em>csv x</h3>
<p>Convert x to csv format.  Works on lists and tables.  You can also use <em>`</em>cs.
</p>
<div class="example">
<pre class="example"> `csv [[]a:1 2;b:3. 4.]
a,b 
1,3.
2,4.
</pre></div>

<span id="read-json"></span><span id="read-json-_21d2-_0060js_003fx"></span><h3 class="section">11.4 read json &rArr; <em>`</em>js?x</h3>
<p>Convert x from json format.  Works on lists and tables.
</p>
<div class="example">
<pre class="example"> `js?(&quot;{a:1,b:3.}&quot;;&quot;{a:2,b:4.}&quot;)
a b 
- --
1 3.
2 4.
</pre></div>

<span id="write-json"></span><span id="write-json-_21d2-_0060js-x"></span><h3 class="section">11.5 write json &rArr; <em>`</em>js x</h3>
<p>Convert x to json format.  Works on lists and tables.
</p>
<div class="example">
<pre class="example"> `js [[]a:1 2;b:3. 4.]
{a:1,b:3.}
{a:2,b:4.}
</pre></div>

<span id="read-nv"></span><span id="read-name-value-_21d2-_0060nv_003fx"></span><h3 class="section">11.6 read name value &rArr; <em>`</em>nv?x</h3>
<p>Convert x, a list of name:value pairs, to a dictionary.
</p>
<div class="example">
<pre class="example"> `nv?(&quot;key1:value1&quot;;&quot;key2:value2&quot;)
key1|value1
key2|value2
</pre></div>

<span id="w-line"></span><span id="write-line-_21d2-x-0_003ay"></span><h3 class="section">11.7 write line &rArr; x 0:y</h3>
<p>Output to x the list of strings in y.  y must be a list of strings.  If y is a single string then convert to list via <a href="#enlist">list</a>.
</p>
<div class="example">
<pre class="example"> &quot;&quot;0:(&quot;blue&quot;;&quot;red&quot;)      / &quot;&quot; represents stdout
blue
red

 &quot;file.txt&quot; 0: (&quot;blue&quot;; &quot;red&quot;) / write to file, one line per element
</pre></div>

<span id="r-line"></span><span id="read-line-_21d2-0_003ax"></span><h3 class="section">11.8 read line &rArr; 0:x</h3>
<p>Read from file x.
</p>
<div class="example">
<pre class="example"> 0:&quot;some.csv&quot;
a,b 
1,3.
2,4.
</pre></div>

<span id="w-byte"></span><span id="write-byte-_21d2-x-1_003ay"></span><h3 class="section">11.9 write byte &rArr; x 1:y</h3>
<p>Output to file x the list of chars in y as bytes.
</p>
<div class="example">
<pre class="example"> &quot;some.txt&quot;1:&quot;0123ABab&quot;
&quot;some.txt&quot;

 1:&quot;some.txt&quot;
&quot;0123ABab&quot;

 &quot;some.csv&quot; 1:`csv [[]a:1 2;b:3. 4.]
&quot;some.csv&quot;

 1: &quot;some.csv&quot;
&quot;a,b\n1,3.00\n2,4.00\n&quot;

 `csv?1:&quot;some.csv&quot;
a b
- -
1 3
2 4
</pre></div>

<span id="r-byte"></span><span id="read-byte-_21d2-1_003ax"></span><h3 class="section">11.10 read byte &rArr; 1:x</h3>
<p>Read from byte data from file x.  See <a href="#w-byte">w byte</a> for an example to write and then read byte data.
</p>
<span id="r-data"></span><span id="read-data-_21d2-2_003a-x"></span><h3 class="section">11.11 read data &rArr; 2: x</h3>

<p>Enterprise Only
</p>
<p>Load file, eg. csv or from a (x 2: y) save.  For the latter, one can find a &ldquo;save then load&rdquo; example in the next section.
</p>
<div class="example">
<pre class="example"> 2:`t.csv
s    t        e p  z   
---- -------- - -- ----
AABL 09:30:00 D 11 4379
AABL 09:30:00 B 40 3950

&nbsp;2:`r                / read from file
a          b          c          d          e         
---------- ---------- ---------- ---------- ----------
0.5366064  0.8250996  0.8978589  0.4895149  0.6811532 
0.1653467  0.05017282 0.4831432  0.4657975  0.4434603 
0.08842649 0.8885677  0.23108    0.3336785  0.6270692 
..

</pre></div>

<span id="w-data"></span><span id="write-data-_21d2-x-2_003a-y"></span><h3 class="section">11.12 write data &rArr; x 2: y</h3>

<p>Enterprise only
</p>
<p>Save to file x non-atomic data y (e.g., lists, dictionaries, or tables). 
</p>
<p>This example saves 100 million 8-byte doubles to file.  The session is then closed and a fresh session reads in the file.  Both the write (420 ms) and compute statistics from the file  have impressive speeds (146 ms) given the file size (800 MB).
</p>
<div class="example">
<pre class="example"> n:_1e8
 r:+`a`b`c`d`e!5^n rand 1.;r
 `r 2:r              / write to file 
</pre></div>

<p>Start new session.
</p>
<div class="example">
<pre class="example"> \t r:2:`r;select avg a,sum b, max c, min d, sum e from r
148
</pre></div>


<span id="k_002dipc-set"></span><span id="k_002dipc-set-_21d2-3_003a"></span><h3 class="section">11.13 k-ipc set &rArr; 3:</h3>

<p>Enterprise only
</p>
<span id="https-get"></span><span id="https-get-_21d2-4_003a"></span><h3 class="section">11.14 https get &rArr; 4:</h3>

<p>Enterprise only
</p>
<span id="ffi_002fpy_002fjs_002f_002e_002e"></span><span id="ffi_002fpy_002fjs_002f_002e_002e-_21d2-5_003a"></span><h3 class="section">11.15 ffi/py/js/.. &rArr; 5:</h3>

<p>Enterprise only
</p>
<p>Load shared library.
</p>
<p>Contents of file &rsquo;a.c&rsquo;
</p><div class="example">
<pre class="example">int add1(int x){return 1+x;}
int add2(int x){return 2+x;}
int indx(int x[],int y){return x[y];}
</pre></div>

<p>Compile into a shared library (done on macos here)
</p><div class="example">
<pre class="example">% clang -dynamiclib -o a.so a.c
</pre></div>

<p>Load the shared library into the session.
</p><div class="example">
<pre class="example">&nbsp;f:&quot;./dev/a.so&quot;5:{add1:&quot;i&quot;;add2:&quot;i&quot;;indx:&quot;Ii&quot;}
&nbsp;f[`add1] 12
13
&nbsp;f[`indx][12 13 14;2]
14
</pre></div>

<hr>
<span id="Tables"></span><div class="header">
<p>
Next: <a href="#kSQL" accesskey="n" rel="next">kSQL</a>, Previous: <a href="#I_002fO" accesskey="p" rel="prev">I/O</a>, Up: <a href="#Top" accesskey="u" rel="up">Top</a> &nbsp; </p>
</div>
<span id="Tables-1"></span><h2 class="chapter">12 Tables</h2>
<p>k9 has the ability to store data in a tabular format containing named columns and rows of information as tables.  If the data to be stored and queried is large, then you should use tables.  This chapter introduces the different types of data tables available in k9.  Table and utable are very similar and as you&rsquo;ll see in the <a href="#kSQL">kSQL</a> chapter are easy to query.  In the <a href="#Benchmark">Benchmark</a> chapter, you&rsquo;ll see that tables are fast to save, read, and query.
</p>
<div class="example">
<pre class="example"> <a href="#table">table</a> t:[[]n:`b`c;i:2 3]
<a href="#utable">utable</a> u: [[n:`b`c]i:2 3]
</pre></div>

<span id="table"></span><span id="table-1"></span><h3 class="section">12.1 table</h3>
<p>The table is the most basic of the three types.  A table consists of columns and rows of information where each column has a name.  Tables can be created in three different ways (1) specification via table format, (2) flipping a dictionary, or (3) reading in from a file.
</p>
<span id="Table-format"></span><h4 class="subsection">12.1.1 Table format</h4>
<p>Tables can be created with the table square bracket notation.
</p>
<p>As an example, let&rsquo;s create a table with two columns named &ldquo;a&rdquo; and &ldquo;col2&rdquo; having three rows.  The syntax is to surround the definition with square brackets and then have a first element of empty square brackets. Following those brackets comes first column name, colon, and the list of values, then the second column, and continuing for all the columns. For keyed tables, the initial square brackets will contain key column names as we will discuss later.  
</p>
<div class="example">
<pre class="example"> [[] a:1 20 3; col2: 3.6 4.8 0.1]
a  col2
-- ----
 1 3.6 
20 4.8 
 3 0.1

 [[] a:1; col2:3.6]   / will error :class as lists required
[[] a:1; col2:3.6]

:class

 [[] a:,1; col2:,3.6] / using list will succeed
[[]a:,1;col2:,3.6]
</pre></div>

<span id="Dictionary-format"></span><h4 class="subsection">12.1.2 Dictionary format</h4>
<p>Tables can also be created by flipping a dictionary into a table.  
</p>
<div class="example">
<pre class="example"> +`a`col2!(1 20 3;  3.6 4.8 0.1)      / +columnnames!(values)
a  col2
-- ----
 1 3.6 
20 4.8 
 3 0.1 
</pre></div>

<span id="File-import"></span><h4 class="subsection">12.1.3 File import</h4>
<p>Tables can also be created by reading in a file.
</p>
<p>t.csv
</p><pre class="verbatim">a, col2
1, 3.6
20, 4.8
3, 0.1
</pre>
<p>Use load file <code>2:x</code> which returns a table.
</p>
<div class="example">
<pre class="example"> 2:`t.csv
a   col2
-- -----
 1  3.6 
20  4.8 
 3  0.1 
</pre></div>

<span id="utable"></span><span id="utable-1"></span><h3 class="section">12.2 utable</h3>
<p>utable (or key table) is a table where some of the columns are keyed. The combination of those columns  should not have two rows with the same values. This must be enforced by the application.
</p>
<div class="example">
<pre class="example"> [[d:2020.09.08 2020.09.09 2020.09.10]p:140 139 150]
d         |p  
----------|---
2020.09.08|140
2020.09.09|139
2020.09.10|150

 `d^ [[]d:2020.09.08 2020.09.09 2020.09.10;p:140 139 150]
d         |p  
----------|---
2020.09.08|140
2020.09.09|139
2020.09.10|150
</pre></div>


<hr>
<span id="kSQL"></span><div class="header">
<p>
Next: <a href="#System" accesskey="n" rel="next">System</a>, Previous: <a href="#Tables" accesskey="p" rel="prev">Tables</a>, Up: <a href="#Top" accesskey="u" rel="up">Top</a> &nbsp; </p>
</div>
<span id="kSQL-1"></span><h2 class="chapter">13 kSQL</h2>
<p>kSQL is a powerful query language for tables.  It has similarities to ANSI SQL but additional features to make it easier to work with ordered data, such as time series data.
</p>
<div class="example">
<pre class="example">Database
<a href="#select">select</a>[<a href="#G">G</a>]<a href="#A">A</a> from T <a href="#where-C">where C</a>; <a href="#update">update</a> <a href="#A">A</a> from T <a href="#where-C">where C</a>; <a href="#delete">delete</a> from T <a href="#where-C">where C</a>

<a href="#Joins">Joins</a>
x,y      / <a href="#insert">insert</a>, <a href="#upsert">upsert</a>, <a href="#union">union</a>, equi-and-asof <a href="#leftjoin">leftjoin</a>
x+y      / equi-and-asof outerjoin (e.g. combine markets through time)
x#y      / take/intersect innerjoin
x_y      / drop/difference
</pre></div>

<span id="Queries"></span><h3 class="section">13.1 Queries</h3>
<p>Queries can be done either via the kSQL or functional forms.  The kSQL form is general simplier to write while the functional form allows one to more easily run multithreaded or build queries programmatically.  
</p>
<span id="select"></span><span id="select-1"></span><h4 class="subsection">13.1.1 select</h4>
<p>There a number of ways to return a complete table with kSQL.  You can use the table name, a kSQL query without columns, or a fully specified query with columns.
</p>
<div class="example">
<pre class="example"> n:5;t:[[]x:!n;y:sin !n]
 t
x y         
- ----------
0 0.        
1 0.841471  
2 0.9092974 
3 0.14112   
4 -0.7568025

 select x,y from t
x y         
- ----------
0 0.        
1 0.841471  
2 0.9092974 
3 0.14112   
4 -0.7568025

 `x`y#t
x y         
- ----------
1 0.841471  
2 0.9092974 
3 0.14112   
4 -0.7568025
</pre></div>

<span id="A"></span><span id="A-1"></span><h4 class="subsection">13.1.2 A</h4>
<p>A is the list of fields to return from the select or update query.  A can create new column names.  
</p>
<div class="example">
<pre class="example"> n:5;t:[[]x:!n;y:sin !n];t
x y         
- ----------
0 0.        
1 0.841471  
2 0.9092974 
3 0.14112   
4 -0.7568025

 select x from t
x
-
0
1
2
3
4

`x#t
x
-
0
1
2
3
4


 select y,x from t    / reorder columns
y          x
---------- -
0.         0
0.841471   1
0.9092974  2
0.14112    3
-0.7568025 4

 `y`x#t
y          x
---------- -
0          0
0.841471   1
0.9092974  2
0.14112    3
-0.7568025 4

 select x,z:y from t  / create new column z
x z         
- ----------
0 0.        
1 0.841471  
2 0.9092974 
3 0.14112   
4 -0.7568025
</pre></div>

<span id="G"></span><span id="G-1"></span><h4 class="subsection">13.1.3 G</h4>
<p>kSQL also has a way to group rows using <code>[G]</code>.  The result is a utable where the key is determined by the grouping clause.
</p>
<div class="example">
<pre class="example"> n:5;t:[[]x:!n;y:sin !n]
 select[x&gt;2]sum y from t / select sum y by x&gt;2 from t
x|y         
-|----------
0|1.750768  
1|-0.6156825

 t :+/'y@=x&gt;2
0|1.750768  
1|-0.6156825
</pre></div>

<span id="where-C"></span><span id="where-C-1"></span><h4 class="subsection">13.1.4 where C</h4>
<p>kSQL makes it easy to build up a where clause to filter down the table.  C is the list of constraints.
</p>
<div class="example">
<pre class="example"> n:5;t:[[]x:!n;y:sin !n]
 select from t where x&gt;0
x y         
- ----------
1 0.841471  
2 0.9092974 
3 0.14112   
4 -0.7568025

 (:x&gt;0)#t
x y         
- ----------
1 0.841471  
2 0.9092974 
3 0.14112   
4 -0.7568025

select from t where (x&gt;0), y within 0 .9
x y       
- --------
1 0.841471
3 0.14112

 (:x&gt;0;:y within .0 .9)#t
x y       
- --------
1 0.841471
3 0.14112 
</pre></div>

<span id="Query-with-By-and-Where"></span><h4 class="subsection">13.1.5 Query with By and Where</h4>

<div class="example">
<pre class="example"> n:5;t:[[]x:!n;y:sin !n]
 select[x&gt;2]sum y from t&amp;t :y&gt;0 / select sum y by x&gt;2 from t where y&gt;0
x|y       
-|--------
0|1.750768
1|0.14112

 ((:y&gt;0)#t) :+/'y@=x&gt;2
0|1.750768
1|0.14112 
</pre></div>

<span id="update"></span><span id="update-1"></span><h4 class="subsection">13.1.6 update</h4>
<p>update allows one to modify values without specifying all the fields that pass through.  update is also used to add new columns in a table.  update does not, by itself, save the modifications to the table. If you want to preserve those modifications, use assignment.
</p>
<div class="example">
<pre class="example"> t:[[]x:`a`b`c;y:1 2 3];t
x y
- -
a 1
b 2
c 3

 update y+18 from t
x y 
- --
a 19
b 20
c 21

 update z:y+18 from t
x y z 
- - --
a 1 19
b 2 20
c 3 21

 t:update z:y+18 from t; / save the updates into table t
 t                       / Now t has the updated values.
x y z 
- - --
a 1 19
b 2 20
c 3 21
</pre></div>

<span id="delete"></span><span id="delete-1"></span><h4 class="subsection">13.1.7 delete</h4>
<p>Delete rows from a table that satisfy one or more conditions.  Currently not working.
</p>
<div class="example">
<pre class="example"> t:[[]x:`a`b`c;y:1 2 1];t
x y
- -
a 1
b 2
c 1

 delete from t where y&gt;1
!value

 delete from t where x=`c,y=1
!nyi
</pre></div>

<span id="Joins"></span><span id="Joins-1"></span><h3 class="section">13.2 Joins</h3>
<p>k9 has a number of methods to join tables together which are described below.  In this section t, t1 and t2 represent tables and k, k1 and k2 represent utables.
</p>
<table>
<tr><td><b>join</b></td><td><b>syntax</b></td></tr>
<tr><td><a href="#union">union</a></td><td>t1,t2</td></tr>
<tr><td><a href="#leftjoin">leftjoin</a></td><td>t,k</td></tr>
<tr><td><a href="#outer">outer</a></td><td>k1,k2</td></tr>
<tr><td><a href="#asof">asof</a></td><td>t,k</td></tr>
<tr><td><a href="#asof_002b">asof+</a></td><td>k1+k2</td></tr>
</table>

<span id="union"></span><span id="union-join-_21d2-t1_002ct2"></span><h4 class="subsection">13.2.1 union join &rArr; t1,t2</h4>
<p>Union join table t1 with table t2.  The tables should have the same columns and the join results in a table with t2 appended to t1.  If the tables do not have the same columns then return t1.
</p>
<div class="example">
<pre class="example">&nbsp;t1:[[]s:`a`b;p:1 2;q:3 4]
&nbsp;t2:[[]s:`b`c;p:11 12;q:21 22]
&nbsp;t1
s p q
- - -
a 1 3
b 2 4

&nbsp;t2
s p  q 
- -- --
b 11 21
c 12 22

&nbsp;t1,t2
s p  q 
- -- --
a  1  3
b  2  4
b 11 21
c 12 22
</pre></div>

<span id="leftjoin"></span><span id="leftjoin-_21d2-t_002ck"></span><h4 class="subsection">13.2.2 leftjoin &rArr; t,k</h4>
<p>leftjoin table t with utable k.  Result includes all rows from t and the values from table k having the same key values.
If a row of t has key values not found in k, then the t values are shown and 0 for the columns coming from k.
</p>
<div class="example">
<pre class="example"> t:[[]s:`a`b`c;p:1 2 3;q:7 8 9]
 k:[[s:`a`b`x`y`z]q:101 102 103 104 105;r:51 52 53 54 55]
 t
s p q
- - -
a 1 7
b 2 8
c 3 9

 k
s|q   r 
-|--- --
a|101 51
b|102 52
x|103 53
y|104 54
z|105 55

 / t.s includes the value `c. Because k.s does not include c,
 / the last row shows a 0 under the r column (which comes from k).
 t,k       
s p q   r 
- - --- --
a 1 101 51
b 2 102 52
c 3   9  0
</pre></div>

<span id="outer"></span><span id="outer-join-_21d2-k1_002ck2"></span><h4 class="subsection">13.2.3 outer join &rArr; k1,k2</h4>
<p>Outer join utable k1 and k2. 
</p>
<div class="example">
<pre class="example"> k1:[[s:`a`b]p:1 2;q:3 4]
 k2:[[s:`b`c]p:9 8;q:7 6]
 k1
s|p q
-|- -
a|1 3
b|2 4

 k2
s|p q
-|- -
b|9 7
c|8 6

 k1,k2
s|p q
-|- -
a|1 3
b|9 7
c|8 6

 k1:[[s:`a`b]p:1 1;q:10 10]
 k2:[[s:`b`c]p:2 2;q:20 20]
 k3:[[s:`c`d]p:3 3;q:30 30]

k1,k2,k3       / joining a 3rd
s|p q 
-|- --
a|1 10
b|2 20
c|3 30
d|3 30

 ,/(k1;k2;k3)  / join over
s|p q 
-|- --
a|1 10
b|2 20
c|3 30
d|3 30
</pre></div>

<span id="asof"></span><span id="asof-join-_21d2-t_002ck"></span><h4 class="subsection">13.2.4 asof join &rArr; t,k</h4>
<p>Asof joins each row rt of table t to a row rk in utable k (keyed by time) provided rk has the maximum time value of any row in k while obeying the constraint that the time value in rt &gt;= the time value of rk. Intuitively, rk should be the row in k that is most up-to-date with respect to rt. 
</p>
<div class="example">
<pre class="example"> t:[[]t:09:30+5*!5;p:100+!5];t
t     p  
----- ---
09:30 100
09:35 101
09:40 102
09:45 103
09:50 104

 k:[[t:09:32 09:41 09:45]q:50 51 52];k
t    |q 
-----|--
09:32|50
09:41|51
09:45|52

 / Notice below the t row at 09:45 is linked with the k row at 09:45.
 / The k row at 09:41 is not linked with any t row.
 / By contrast, both the 09:35 and the 09:40 rows of t
 / are linked to the 09:32 row of k.
 t,k      
          
t     p   q 
----- --- --
09:30 100  0
09:35 101 50
09:40 102 50
09:45 103 52
09:50 104 52
</pre></div>

<p>Scaling this up to a bigger set of tables one can see the performance of k9 on joins.
</p>
<div class="example">
<pre class="example"> N:_1e8;T:[[]t:N rand `t 0;q:N rand 100];5#T
t            q 
------------ --
00:00:00.001 44
00:00:00.002 46
00:00:00.002 48
00:00:00.003 35
00:00:00.003 43

 n:_1e5;K:[[t:n rand `t 0]p:n rand 100];5#K
t           |p 
------------|--
00:00:00.481|54
00:00:00.961|63
00:00:01.094|67
00:00:01.479|16
00:00:01.917|58

 \t T,K
222
</pre></div>

<span id="asof_002b"></span><span id="asof_002b-join-_21d2-k1_002bk2"></span><h4 class="subsection">13.2.5 asof+ join &rArr; k1+k2</h4>
<p>Asof+ joins  allows one to aggregate over markets to find the total available at a given time.  The utables need to be specified with <code>`a</code>. The effect is to merge the two key fields (the field t in this case) and for each row rk1 from table k1, add the non-key field (bs in this case) from rk1 to the bs field of the most recent row in k2 whose t value is less than or equal to the t value in rk1. And symmetrically for each row of table k2.
</p>
<div class="example">
<pre class="example"> k1:`a [[t:09:30+5*!5]bs:100*1 2 3 2 1];k1
t    |bs 
-----|---
09:30|100
09:35|200
09:40|300
09:45|200
09:50|100

 k2:`a [[t:09:32 09:41 09:45]bs:1 2 3];k2
t    |bs
-----|--
09:32| 1
09:41| 2
09:45| 3

 k1+k2
t    |bs 
-----|---
09:30|100
09:32|101
09:35|201
09:40|301
09:41|302
09:45|203
09:50|103
</pre></div>

<span id="Insert-and-Upsert"></span><h3 class="section">13.3 Insert and Upsert</h3>
<p>One can add data to tables via insert or upsert.  The difference between the two is that insert adds data to a table while upsert on some key x will replace the values if x is present in the target table or insert x with its associated value otherwise. 
</p>
<span id="insert"></span><span id="insert-_21d2-t_002cd"></span><h4 class="subsection">13.3.1 insert &rArr; t,d</h4>
<p>Insert dictionary d into table t.
</p><div class="example">
<pre class="example"> t:[[]c1:`a`b`a;c2:1 2 7];t
c1 c2
-- --
a   1
b   2
a   7

 t,`c1`c2!(`a;12)
c1 c2
-- --
a   1
b   2
a   7
a  12

 t,`c1`c2!(`c;12)
c1 c2
-- --
a   1
b   2
a   7
c  12
</pre></div>

<span id="upsert"></span><span id="upsert-_21d2-k_002cd"></span><h4 class="subsection">13.3.2 upsert &rArr; k,d</h4>
<p>Insert dictionary d into utable k.
</p><div class="example">
<pre class="example"> k:[[c1:`a`b`c]c2:1 2 7];k
c1|c2
--|--
a | 1
b | 2
c | 7

 k,`c1`c2!(`a;12)
c1|c2
--|--
a |12
b | 2
c | 7

 k,`c1`c2!(`b;12)
c1|c2
--|--
a | 1
b |12
c | 7

 k,`c1`c2!(`d;12)
c1|c2
--|--
a | 1
b | 2
c | 7
d |12
</pre></div>

<hr>
<span id="System"></span><div class="header">
<p>
Next: <a href="#Control-Flow" accesskey="n" rel="next">Control Flow</a>, Previous: <a href="#kSQL" accesskey="p" rel="prev">kSQL</a>, Up: <a href="#Top" accesskey="u" rel="up">Top</a> &nbsp; </p>
</div>
<span id="System-1"></span><h2 class="chapter">14 System</h2>
<p>k9 comes with a few system functions and measurement commands.  The commands allow you to load a script, change the working directory, measure execution times and memory usage, and list defined variables.
</p>
<div class="example">
<pre class="example">System
\l a.k <a href="#load">load</a>
\t:n x <a href="#timing">timing</a>
\u:n
\v     <a href="#variables">variables</a>
\w     <a href="#memory">memory</a>
\cd x  <a href="#cd">cd</a>
</pre></div>

<span id="load"></span><span id="load-_21d2-_005cl-a_002ek"></span><h3 class="section">14.1 load &rArr; \l a.k</h3>
<p>Load a text file of k9 commands.  The file name must end in .k.
</p><div class="example">
<pre class="example">&nbsp;\l func.k
\l func.k
&nbsp;\l func.k7  / will error as not .k
:nyi
</pre></div>

<span id="timing"></span><span id="timing-_21d2-_005ct-x-or-_005ct_003an-x"></span><h3 class="section">14.2 timing &rArr; \t x or \t:n x</h3>
<p>List time elapsed in milliseconds in evaluting x.  If n is supply then repeat x, n times.
</p>
<div class="example">
<pre class="example"> \t ^(_10e6)rand _1e8     / sort 10 million numbers
227

 \t:10 ^(_10e6)rand _1e8  / perform 10 times the sort
2027
</pre></div>

<span id="variables"></span><span id="variables-_21d2-_005cv"></span><h3 class="section">14.3 variables &rArr; \v</h3>
<p>List variables
</p><div class="example">
<pre class="example">a:1;b:2;c:3
&nbsp;\v
[v:`a`b`c]
</pre></div>

<span id="memory"></span><span id="memory-_21d2-_005cw"></span><h3 class="section">14.4 memory &rArr; \w</h3>
<p>List memory usage
</p><div class="example">
<pre class="example">&nbsp;\w
0
&nbsp;r:(`i$10e6)rand 10
&nbsp;\w
2097158
</pre></div>

<span id="cd"></span><span id="cd-_21d2-_005ccd-x"></span><h3 class="section">14.5 cd &rArr; \cd x</h3>
<p>Change directory (cd) into x
</p>
<div class="example">
<pre class="example">&nbsp;\cd scripts
</pre></div>

<hr>
<span id="Control-Flow"></span><div class="header">
<p>
Next: <a href="#Temporal-Functions" accesskey="n" rel="next">Temporal Functions</a>, Previous: <a href="#System" accesskey="p" rel="prev">System</a>, Up: <a href="#Top" accesskey="u" rel="up">Top</a> &nbsp; </p>
</div>
<span id="Control-Flow-1"></span><h2 class="chapter">15 Control Flow</h2>
<p>Though looping statements are not necessary in k9, if-then-else statements are sometimes useful.
</p>
<pre class="verbatim">$[b;t;f] cond
</pre>
<span id="cond"></span><span id="cond-_21d2-_0024_005bb_003bt_003bf_005d"></span><h3 class="section">15.1 cond &rArr; $[b;t;f]</h3>
<p>If b is non zero then x else y.  x and y are not required to be of the same type.
</p>
<div class="example">
<pre class="example"> $[3&gt;2;`a;`b]
`a

 $[2&gt;3;`a;`b]
`b

 $[37;12;10]
12

 $[1b;`a`b!(1 2;3 4);`n]
a|1 2
b|3 4

 $[1b;a:3;b:2]
3
 a
3
 b   / is not set as the f case not evaluated
!value
</pre></div>

<hr>
<span id="Temporal-Functions"></span><div class="header">
<p>
Next: <a href="#Errors" accesskey="n" rel="next">Errors</a>, Previous: <a href="#Control-Flow" accesskey="p" rel="prev">Control Flow</a>, Up: <a href="#Top" accesskey="u" rel="up">Top</a> &nbsp; </p>
</div>
<span id="Temporal-Functions-1"></span><h2 class="chapter">16 Temporal Functions</h2>
<p>k9 has functions (within <code>.z</code>) to get the current date and time to various degrees of precision.  There are also functions to retrieve partial date and time using dot notation.
</p>
<pre class="verbatim">date 2001.01.01   .z.d
time 12:34:56.789 .z.t
</pre>
<span id="g_t_002ez_002e_005bdm_005d-date"></span><h3 class="section">16.1 .z.[dm] date</h3>
<p>These functions retrieve the date as day (d) or month (m) precision.
</p>
<div class="example">
<pre class="example"> .z.d
2020.12.13

 .z.m
2020.12.
</pre></div>

<span id="g_t_002ez_002e_005bhrstuv_005d-time"></span><h3 class="section">16.2 .z.[hrstuv] time</h3>
<p>These functions retrieve the time at hour (h), minute (r), second (s), millisecond (t), microsecond (u), or nanosecond (v) precision.
</p>
<div class="example">
<pre class="example"> .z.h
11
 .z.r
11:25
 .z.s
11:25:16
 .z.t
11:25:16.842
 .z.u
11:25:17.491362
 .z.v
11:25:18.186360064
</pre></div>

<p>One could use the current time commands to measure run time but typically this is done via <code>\t</code>
</p>
<div class="example">
<pre class="example"> t1:.z.v;(_2e8)rand 1.;t2:.z.v;t2-t1
00:00:00.609207008

\t (_2e8)rand 1.
610
</pre></div>

<span id="Temporal-dot-functions"></span><h3 class="section">16.3 Temporal dot functions</h3>
<p>These functions use dot notation to retrieve partial date and times.
</p>
<div class="example">
<pre class="example"> now:.z.v;now
11:27:18.049558016
 now.h
11
 now.r
11:27
 now.s
11:27:18
 now.t
11:27:18.049
 now.u
11:27:18.049558
 now.v
11:27:18.049558016
</pre></div>

<hr>
<span id="Errors"></span><div class="header">
<p>
Next: <a href="#Examples" accesskey="n" rel="next">Examples</a>, Previous: <a href="#Temporal-Functions" accesskey="p" rel="prev">Temporal Functions</a>, Up: <a href="#Top" accesskey="u" rel="up">Top</a> &nbsp; </p>
</div>
<span id="Errors-1"></span><h2 class="chapter">17 Errors</h2>
<p>Given the terse syntax of k9, it likely won&rsquo;t be a surprise  that  error messages are also rather short.  The errors are listed on the help page and described in more detail below.
</p>
<div class="example">
<pre class="example">error: <a href="#class">class</a> <a href="#rank">rank</a> <a href="#length">length</a>
<a href="#g_t_005ftype">type</a> <a href="#domain">domain</a> <a href="#limit">limit</a>
stack <a href="#eparse">parse</a> <a href="#g_t_005fvalue">value</a>
</pre></div>

<span id="class"></span><span id="g_t_003aclass"></span><h3 class="section">17.1 :class</h3>
<p>Calling a function on mismatched types.
</p><div class="example">
<pre class="example">&nbsp;3+`b
:class
</pre></div>

<span id="rank"></span><span id="g_t_003arank"></span><h3 class="section">17.2 :rank</h3>
<p>Calling a function with too many parameters.
</p><div class="example">
<pre class="example">&nbsp;{x+y}[1;2;3]
{x+y}[1;2;3]
^
:rank
</pre></div>

<span id="length"></span><span id="g_t_003alength"></span><h3 class="section">17.3 :length</h3>
<p>Operations on unequal length lists that require equal length.
</p><div class="example">
<pre class="example">&nbsp;(1 2 3)+(4 5)
:length
</pre></div>

<span id="g_t_005ftype"></span><span id="g_t_003atype"></span><h3 class="section">17.4 :type</h3>
<p>Calling a function with an unsupported variable type.
</p><div class="example">
<pre class="example">`a+`b
&nbsp; ^
:type
</pre></div>

<span id="domain"></span><span id="g_t_003adomain"></span><h3 class="section">17.5 :domain</h3>
<p>Exhausted the number of input values
</p><div class="example">
<pre class="example">&nbsp;-12?10   / only 10 unique value exist
:domain
</pre></div>

<span id="limit"></span><span id="g_t_003alimit"></span><h3 class="section">17.6 :limit</h3>
<p>Exceeded a limit above the software maximum, eg. writing a single file above 1GB.
</p><div class="example">
<pre class="example">&nbsp;n:_100e6;d:+`x`y!(!n;n rand 1.);`d 2:d
n:_100e6;d:+`x`y!(!n;n rand 1.);`d 2:d

:limit
</pre></div>

<span id="nyi"></span><span id="g_t_003anyi"></span><h3 class="section">17.7 :nyi</h3>
<p>Running code that is not yet implemented.  This may come from running code in this document with a different version of k9.
</p>
<p>2020.05.31 (c) shakti
</p>
<div class="example">
<pre class="example">&nbsp;=+`a`b!(1 2;1 3)
a b| 
- -|-
1 1|0
2 3|1
</pre></div>

<p>Aug  6 2020 16GB (c) shakti
</p>
<div class="example">
<pre class="example">&nbsp;=+`a`b!(1 2;1 3)
=+`a`b!(1 2;1 3)
^
:nyi
</pre></div>

<span id="eparse"></span><span id="g_t_003aparse"></span><h3 class="section">17.8 :parse</h3>
<p>Syntax is wrong.  This may be due to mismatched parentheses or  brackets, e.g., (), {}, [], &quot;&quot;.
</p><div class="example">
<pre class="example">&nbsp;{37 . &quot;hello&quot;
:parse
</pre></div>

<span id="g_t_005fvalue"></span><span id="g_t_003avalue"></span><h3 class="section">17.9 :value</h3>
<p>Undefined variable is used.
</p><div class="example">
<pre class="example">&nbsp;g    / assuming 'g' has not be defining in this session
:value
</pre></div>
<hr>
<span id="Examples"></span><div class="header">
<p>
Next: <a href="#Benchmark" accesskey="n" rel="next">Benchmark</a>, Previous: <a href="#Errors" accesskey="p" rel="prev">Errors</a>, Up: <a href="#Top" accesskey="u" rel="up">Top</a> &nbsp; </p>
</div>
<span id="Examples-1"></span><h2 class="chapter">18 Examples</h2>
<p>This chapter presents an example from finance, as this is one of the primary application domains for k.  For those not familiar with this field, here is a short introduction.
</p>
<span id="A-Tiny-Introduction-to-Financial-Market-Data"></span><h3 class="section">18.1 A Tiny Introduction to Financial Market Data</h3>
<p>Financial market data generally are stored as prices (often call quotes) and trades.  At a minimum, prices will include time (t), price to buy (b for bid) and price to sell (a for ask).  Trades will include at a minimum time (t) and trade price (p).  In normal markets there are many more prices than trades.  (Additionally, the data normally includes the name of the security (s) and the exchange (x) from which the data comes.)  
</p>
<p>Let&rsquo;s use k9 to generate a set of random prices.
</p>
<div class="example">
<pre class="example"> n:10
 T:^10:00+`t n rand 36e5 / sort randomly generated times
 B:100++\-1+n rand 3     / generate bids near 100, equivalent to: 100 + (+\((-1)+n rand 3))
 A:B+1+n rand 2          / generates asks 1 or 2 higher
 q:+`t`b`a!(T;B;A);q     / build table t and then display
t            b   a  
------------ --- ---
10:01:48.464 100 102
10:23:12.033 100 102
10:30:00.432 101 102
10:34:00.383 101 103
10:34:36.839 101 102
10:42:59.230 100 102
10:46:50.478 100 102
10:52:42.189  99 100
10:55:52.208  99 101
10:59:06.262  98  99
</pre></div>

<p>Here you see that at 10:42:59.230 the prices update to 100 and 102.  The price one could sell is 100 and the price to buy is 102.  You might think that 100 seems a bit high so sell there.  Later at 10:59:06.262 you might have thought the prices look low and then buy at 99.  Here&rsquo;s the trade table for those two transactions.
</p>
<div class="example">
<pre class="example"> t:+`t`p!(10:43:00.230 10:59:07.262:;100 99);t
t            p  
------------ ---
10:43:00.230 100
10:59:07.262  99
</pre></div>

<p>You&rsquo;ll note that the times didn&rsquo;t line up, because it apparently took you a second to decide to trade.  Because of this delay, you&rsquo;ll often have to look back at the previous prices to join trade (t) and quote (q) data.
</p>
<p>Now that you&rsquo;ve learned enough finance to understand the data, let&rsquo;s scale up to larger problems to see the power of k9.
</p>

<span id="Data-Manipulation"></span><h3 class="section">18.2 Data Manipulation</h3>
<p>Generate a table of random data and compute basic statistics quickly.  The data here includes time (t), security (s), and price delta (d).  This table takes about 4 GB and 3.3 seconds on a relatively new consumer laptop.
</p>
<div class="example">
<pre class="example">&nbsp;n:_100e6                         / set n to 100 million 
&nbsp;t:{09:00:00.000+x rand 10:00:00.000}  /  x random times between 9:00 and 19:00 (7 pm)
&nbsp;s:{x rand `a`b`c`d`e}                 / x random symbols from `a`b`c`d`e
&nbsp;m:0,(|m),365378984,m:271810244 42800467 2636454 62769 572 2;  / start m with 6 numbers, then regenerate m with 0, |m, 365378984, m
&nbsp;d:{(-6+!13)@(+\m)bin x rand _1e9}  / (i) Take the running sum of m. 
&nbsp;               / (ii) find the binary search index values of the x random numbers drawn up to 1e9 using bin
&nbsp;               / (iii) use those indexes on the array of integers from -6 to +6 inclusive
&nbsp;\t q:+`t`s`d!(t[n];s[n];d[n])    / build table and measure time in ms
3391
</pre></div>

<p>As this point one might want to check start and stop times, see if the symbol distribution is actually random and look at the distribution of the price deltas.
</p>
<div class="example">
<pre class="example"> select ti:min t, tf:max t from q / min and max time values
ti|09:00:00.000
tf|18:59:59.999

 select c: count s by s from q          / count each symbol
s|c       
-|--------
a|20003490
b|19997344
c|19998874
d|20000640
e|19999652

 select c: count d by d from q          / check normal dist (2s to run)
d |c       
--|--------
-6|1       
-5|55      
-4|6226    
-3|263801  
-2|4280721 
-1|27179734
 0|36531595
 1|27188092
 2|4279872 
 3|263610  
 4|6245    
 5|48

 select gain:sum d by s from q    / profit (or loss) over each symbol
s|gain 
-|-----
a|  872
b| 2765
c| 2668
d| 2171
e|-2354

 select loss:min +\d by s from q  / worst loss over the period
s|loss 
-|-----
a|-1803
b| -846
c|-2732
d|-2101
e|-2903
</pre></div>

<span id="Understanding-Code-Examples"></span><h3 class="section">18.3 Understanding Code Examples</h3>
<p>In the shakti mailing list there are a number of code examples that can be used to learn best practices.  In order to make sense of other people&rsquo;s codes, one needs to be able to efficiently understand  k9 language expressions.  Here is an example of how one goes about this process.
</p>
<div class="example">
<pre class="example">ss:{*{
      o:o@&amp;(-1+(#y)+*x@1)&lt;o:1_x@1;
      $[0&lt;#x@1;((x@0),*x@1;o);x]}[;y]/:(();&amp;(x@(!#x)+\:!#y)~\:y)
      }
</pre></div>

<p>This function finds a substring in a string.
</p>
<pre class="verbatim"> 000000000011111111112222222222333333
 012345678901234567890123456789012345
&quot;Find the +++ needle in + the ++ text&quot;
</pre>
<p>Here one would expect to find &ldquo;++&rdquo; at 9 and 29.
</p>
<div class="example">
<pre class="example">&nbsp;ss[&quot;Find the +++ needle in + the ++ text&quot;;&quot;++&quot;]
9 29
</pre></div>

<p>In order to determine how this function works let&rsquo;s strip out the details...
</p>
<div class="example">
<pre class="example">ss:{
    *{
      o:o@&amp;(-1+(#y)+*x@1)&lt;o:1_x@1; / set o 
      $[0&lt;#x@1;((x@0),*x@1;o);x]   / if x then y else z
      }
  [;y]/:(();&amp;(x@(!#x)+\:!#y)~\:y)    / use value for inner function
  }
 
</pre></div>

<p>Given that k9 evaluates right to left, let&rsquo;s start with the rightmost code fragment.
</p>
<div class="example">
<pre class="example">&nbsp;(();&amp;(x@(!#x)+\:!#y)~\:y)          / a list (null;value)
</pre></div>

<p>And now let&rsquo;s focus on the value in the list.
</p>
<div class="example">
<pre class="example">&nbsp;&amp;(x@(!#x)+\:!#y)~\:y
</pre></div>

<p>In order to easily check our understanding, we can wrap this in a function and call the function with the parameters shown above.  In order to step through, we can start with the inner parenthesis and build up the code until it is complete.
</p>
<div class="example">
<pre class="example">&nbsp;{!#x}[&quot;Find the +++ needle in + the ++ text&quot;;&quot;++&quot;]
{!#x}[&quot;Find the +++ needle in + the ++ text&quot;;&quot;++&quot;]
^
:rank
</pre></div>

<p>This won&rsquo;t work as one cannot call a function with two arguments and then use only one.  In order to get around this, we will insert code for the second argument but not use it.
</p>
<div class="example">
<pre class="example"> {y;#x}[&quot;Find the +++ needle in + the ++ text&quot;;&quot;++&quot;]
36
 {y;!#x}[&quot;Find the +++ needle in + the ++ text&quot;;&quot;++&quot;]
0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 ..
</pre></div>

<p>As might have been guessed <code>#x</code> counts the number of charcters in the first argument and then <code>!#x</code> generates a list of integers from 0 to n-1.
</p>
<div class="example">
<pre class="example">&nbsp;{(!#x)+\:!#y}[&quot;Find the +++ needle in + the ++ text&quot;;&quot;++&quot;]  
 0  1
 1  2
 2  3
 3  4
 4  5
 5  6
 6  7
 7  8
 8  9
 9 10
10 11
11 12
12 13
13 14
14 15
15 16
16 17
17 18
18 19
19 20
20 21
..
</pre></div>

<p>Here the code takes each integer from the previous calculation and then adds an integer list as long as the second argument to each value.  In order to verify this,  you could write something similar and ensure the output what you predicted.
</p>
<div class="example">
<pre class="example">&nbsp;{(!x)+\:!y}[6;4]
0 1 2 3
1 2 3 4
2 3 4 5
3 4 5 6
4 5 6 7
5 6 7 8
</pre></div>

<p>Now using the matrix above the code indices as the first argument and pull substrings that match the length of the search string.
</p>
<div class="example">
<pre class="example">&nbsp;{x@(!#x)+\:!#y}[&quot;Find the +++ needle in + the ++ text&quot;;&quot;++&quot;]
Fi
in
nd
d 
 t
th
he
e 
 +
++
++
+ 
 n
ne
ee
ed
dl
le
e 
 i
in
..
</pre></div>

<p>At this point one can compare the search substring in this list of substrings to find a match.
</p>
<div class="example">
<pre class="example">&nbsp;{(x@(!#x)+\:!#y)~\:y}[&quot;Find the +++ needle in + the ++ text&quot;;&quot;++&quot;]
000000000110000000000000000001000000b
</pre></div>

<p>And then one can use the where function, <code>&amp;</code>, to determine the index of the matches.
</p>
<div class="example">
<pre class="example">&nbsp;{&amp;(x@(!#x)+\:!#y)~\:y}[&quot;Find the +++ needle in + the ++ text&quot;;&quot;++&quot;]
9 10 29
</pre></div>

<hr>
<span id="Benchmark"></span><div class="header">
<p>
Next: <a href="#Conclusion" accesskey="n" rel="next">Conclusion</a>, Previous: <a href="#Examples" accesskey="p" rel="prev">Examples</a>, Up: <a href="#Top" accesskey="u" rel="up">Top</a> &nbsp; </p>
</div>
<span id="Benchmark-1"></span><h2 class="chapter">19 Benchmark</h2>
<p>Shakti is a fast data analysis language  and clear benchmarks illustrate this.  The Shakti website has a number of files for such purpose, b.k and taxi.k amongst others.  
</p>
<span id="b_002ek"></span><h3 class="section">19.1 b.k</h3>

<pre class="verbatim">T:{09:30:00+_6.5*3600*(!x)%x}
P:{10+x rand 90};Z:{1000+x rand 9000};E:rand[;&quot;ABCD&quot;]

/m:2;n:6
m:7000;n:5600000;
S:(-m)rand `4;N:|1+_n*{x%+/x:exp 15*(!x)%x}m

t:S!{+`t`e`p`z!(T;E;P;Z)@'x}'N
q:S!{+`t`e`b!(T;E;P)@'x}'6*N

a:*A:100#S

\t  {select max p by e from x}'t A
\t  {select sum z by `o t from x}'t A
\t:10 {select last b from x}'q A
\t:10 select from t[a],`t^q a where p&lt;b
\

C:M:rand[;&quot;ABCDEFGHIJ&quot;]
trade(sym time exchange price size cond)
quote(sym time exchange bid bz ask az mode)

                Q1      Q2      Q3      Q4  ETL   RAM   DSK
k                1       9       9       1                                            
postg        71000    1500    1900     INF  200   1.5   4.0
spark       340000    7400    8400     INF  160  50.0   2.4
mongo        89000    1700    5800     INF  900   9.0  10.0   

960 billion quotes (S has 170 billion. QQQ has 6 billion.)
 48 billion trades (S has 12 billion. QQQ has 80 million.)
</pre>
<span id="T"></span><h4 class="subsection">19.1.1 T</h4>
<p>T is a function which generates a uniform list of times from 09:30 to 16:00.
</p>
<div class="example">
<pre class="example">&nbsp;T:{09:30:00+_6.5*3600*(!x)%x}
&nbsp;T[13]           / 13 times with equal timesteps over [start;end)
^09:30:00 10:00:00 10:30:00 11:00:00 11:30:00 .. 15:00:00 15:30:00
&nbsp;rand1_-':T[10000]  / determine the unique timesteps
?00:00:02 00:00:03
</pre></div>

<span id="P_002c-Z_002c-E"></span><h4 class="subsection">19.1.2 P, Z, E</h4>
<p>P is a function to generate values from 10 to 100 (price).  Z is a function to generate values from 100 to 1000 (size).  E is a function to generate values A, B, C, or D (exchange).
</p>
<div class="example">
<pre class="example">&nbsp;P[10]
78 37 56 85 40 68 88 50 41 78
&nbsp;Z[10]
4820 2926 1117 4700 9872 3274 6503 6123 9451 2234
&nbsp;E[10]
&quot;AADCBCCCBC&quot;
</pre></div>

<span id="m_002c-n_002c-S_002c-N"></span><h4 class="subsection">19.1.3 m, n, S, N</h4>
<p>m is the number of symbols.  n is the number of trades.  S is a list of symbol names.  N is a list of  numbers in decreasing order which sum approximately to n.  
</p>
<div class="example">
<pre class="example">&nbsp;4#S
`EEFD`IOHJ`MEJO`DHNK
&nbsp;4#N
11988 11962 11936 11911
&nbsp;+/N
5604390
</pre></div>

<span id="t"></span><h4 class="subsection">19.1.4 t</h4>
<p>t is an ntable of trades.  The fields are time (t), exchange (e), price (p), and size (z).  The number of trades is set by n.
</p>
<p>Pulling one random table from t and showing 10 random rows.  
</p>
<div class="example">
<pre class="example">&nbsp;10 rand*t@1 rand S
t        e p  z   
-------- - -- ----
14:37:53 D 73 4397
11:43:25 B 20 2070
10:21:18 A 53 6190
13:26:03 C 33 7446
14:07:06 B 13 2209
15:08:41 D 12 4779
14:27:37 A 11 6432
11:22:53 D 92 9965
11:12:37 A 14 5255
12:24:28 A 48 3634
</pre></div>

<span id="q"></span><h4 class="subsection">19.1.5 q</h4>
<p>q is a ntable of quotes.  The fields are time (t), exchange (e), and bid (b).  The number of quotes is set to 6*n.
</p>
<div class="example">
<pre class="example">&nbsp;10 rand*q@1 rand S
t        e b 
-------- - --
11:31:12 A 80
14:08:40 C 63
14:05:07 D 12
11:31:43 A 56
12:44:19 A 45
10:13:21 A 71
15:19:08 A 74
13:42:20 D 43
11:31:41 D 66
14:41:38 A 63
</pre></div>

<span id="a_002c-A"></span><h4 class="subsection">19.1.6 a, A</h4>
<p>a is the first symbol of S.  A consists of the first 100 symbols of S.
</p>
<div class="example">
<pre class="example">&nbsp;a
`PKEM
</pre></div>

<span id="Max-price-by-exchange"></span><h4 class="subsection">19.1.7 Max price by exchange</h4>
<p>The query takes 100 tables from the trade ntable and computes the max price by exchange.
</p>
<div class="example">
<pre class="example">&nbsp;*{select max p by e from x}'t A
e|p 
-|--
A|99
B|99
C|99
D|99
&nbsp;\t  {select max p by e from x}'t A
22
</pre></div>

<span id="Compute-sum-of-trade-size-by-hour_002e"></span><h4 class="subsection">19.1.8 Compute sum of trade size by hour.</h4>
<p>This query takes 100 tables from the trade ntable and computes the sum of trade size done by hour.
</p>
<div class="example">
<pre class="example">&nbsp;*{select sum z by `o t from x}'t A
t |z       
--|--------
09| 4885972
10|10178053
11|10255045
12|10243846
13|10071057
14|10203428
15|10176102
&nbsp;\t  {select sum z by `o t from x}'t A
27
</pre></div>

<span id="Compute-last-bid-by-symbol"></span><h4 class="subsection">19.1.9 Compute last bid by symbol</h4>
<p>This query takes the 100 tables from the quote ntable and returns the last bid.
</p>
<div class="example">
<pre class="example">&nbsp;3 rand{select last b from x}'q A
b 
--
18
98
85

&nbsp;\t:10 {select last b from x}'q A
2
</pre></div>

<span id="Find-trades-below-the-bid"></span><h4 class="subsection">19.1.10 Find trades below the bid</h4>
<p>This query operates on one symbol from the q and t ntables, i.e. a single quote and trade table.  The quote table is joined to the trade table giving the current bid on each trade.
</p>
<div class="example">
<pre class="example">&nbsp;4 rand select from t[a],`t^q a where p&lt;b
t        e p  z    b 
-------- - -- ---- --
13:54:35 B 94 1345 96
11:59:52 C 26 1917 89
10:00:44 C 40 9046 81
10:59:39 A 25 5591 72
&nbsp;\t:10 select from t[a],`t^q a where p&lt;b
3
</pre></div>

<span id="taxi"></span><h3 class="section">19.2 taxi</h3>
<p>The taxi data analysis problem has become well known given the ease of acquiring the data and the size of it.  It&rsquo;s well written up  <a href="https://toddwschneider.com/posts/analyzing-1-1-billion-nyc-taxi-and-uber-trips-with-a-vengeance/">here</a> with a benchmark summary <a href="https://tech.marksblogg.com/benchmarks.html">here</a>.  Shakti has a benchmark script to generate simulated taxi data in order to check performance.
</p>
<div class="format">
<pre class="verbatim">/taxi 1.1billion https://tech.marksblogg.com/benchmarks.html
/type/pcount/distance/amount

g:{[[]t:x rand`y`g;p:x rand 9;d:x rand 100;a:x rand 100.]}
x:d!g':44000+&amp;#d:2009.01.01+!2500  /110 million example

ys:{`y[!x]sum/x} / year sum
\t sum{select[t]count from x}':x
\t ys@{select[p]count from x}':x
\t sum{select[p]sum a from x}':x
\t ys@{select[p,d]count from x}':x

\
x:g 10
select[t]count from x
select[p]count from x
select[p]sum a from x
select[p,d]count from x


Q1 select[t]count from x
Q2 select[p]avg a from x
Q3 select[d.y,p]count from x
Q4 select[d.y,p,d]count from x

          cpu  cost core/ram  elapsed         machines
k           4 .0004    4/16    1            1*i3.2xlarge(8v/32/$.62+$.93)
redshift  864 .0900  108/1464  8(1 2 2 3)   6*ds2.8xlarge(36v/244/$6.80)
db/spark 1260 .0900   42/336  30(2 4 4 20) 21*m5.xlarge(4v/16/$.20+$.30)
bigquery 1600 .3200  200/3200  8(2 2 1 3)

cost: k/redshift/databricks(1.5*EC2) bigquery(redshift) $5.00*TB  k($.05/TB)

csv
/vendor,pickup,dropoff,pcount,dist1,plong,plat,rate,flag,dlong,dlat,ptype,fare1,sur1,mta1,tip1,toll1,amount1
t:&quot;b  12            e&quot;  / type(2) passenger(8)
\t t:(`t`p`d`a;&quot;,&quot;;t)0:&quot;taxi.csv&quot;</pre></div>

<span id="g"></span><h4 class="subsection">19.2.1 g</h4>
<p>Function to generate a table of random data to represent taxi company (<b>t</b> either yellow &lsquo;y or green &lsquo;g),  paid fare (<b>p</b> 0-9), distance travelled (<b>d</b> 0-99) and address (<b>a</b> 0-100.).
</p>
<div class="example">
<pre class="example"> g:{[[]t:x rand`y`g;p:x rand 9;d:x rand 100;a:x rand 100.]}
 g 10
t p d  a       
- - -- --------
y 7 38 50.67771
g 5 34 38.51022
y 6 40 9.654263
y 6  5 98.91451
g 7 47 44.40432
g 0 64 66.07784
y 0 99 25.84292
y 5 46 46.87825
y 5 66 81.61647
g 0 10 7.946983
</pre></div>

<span id="x-1"></span><h4 class="subsection">19.2.2 x</h4>
<p>x is an ntable containing 2500 tables, keyed on day.  Each individual table contains 44,000 rows therefore x has 110 million rows in total.
</p>
<div class="example">
<pre class="example"> x:d!g':44000+&amp;#d:2009.01.01+!2500  /110 million example
 x
2009.01.01|[[]t:`y`y`g`y`g`g`y`y`g`g`g`g`g`y`y`y`y`g`g`g..
2009.01.02|[[]t:`y`g`g`g`y`g`y`g`y`g`g`g`g`y`g`y`g`y`g`y..
2009.01.03|[[]t:`y`g`g`g`y`g`y`g`y`g`g`g`g`y`g`y`g`y`g`y..
2009.01.04|[[]t:`y`g`g`g`y`g`y`g`y`g`g`g`g`y`g`y`g`y`g`y..
..
</pre></div>

<span id="g_t2009_002e01_002e04"></span><h4 class="subsection">19.2.3 2009.01.04</h4>
<p>Let&rsquo;s work with a single table to understand the queries and limit it to 5 rows.
</p>
<div class="example">
<pre class="example"> q:5#x 2009.01.04;q
t p d  a       
- - -- --------
y 3 41 54.5307 
g 6 70 70.4241 
g 1 63 81.46645
g 7 36 43.12615
y 1 43 23.50114
</pre></div>

<p>Now let&rsquo;s count the number of rows by field t.  Looking at the data above you should expect 2 yellow (y) taxi trips and 3 green (g) taxi trips.
</p>
<div class="example">
<pre class="example"> select[t]count from q
t|n
-|-
g|3
y|2
</pre></div>

<p>We can also sum the paid fare (p) by taxi company (t).
</p>
<div class="example">
<pre class="example"> select[t]sum p from q
t|p
-|--
g|14
y| 4
</pre></div>

<p>Now if we want to compute the same over all the data we need to run the kSQL query over each table.  We&rsquo;ll do this on parallel threads (<a href="#eachp">eachp</a>) to speed it up.
</p>
<div class="example">
<pre class="example"> {select[t]count from x}':x
2009.01.01|[[t:`g`y]n:21968 22032]
2009.01.02|[[t:`g`y]n:21962 22038]
2009.01.03|[[t:`g`y]n:21962 22038]
2009.01.04|[[t:`g`y]n:21962 22038]
</pre></div>

<p>and then sum over all days.
</p>
<div class="example">
<pre class="example"> sum{select[t]count from x}':x
t|n       
-|--------
g|55010927
y|54989073
</pre></div>

<p>Running the command with the timer will allow us to measure how long it takes to sum over the 110 million examples.
</p>
<div class="example">
<pre class="example"> \t sum{select[t]count from x}':x
1077
</pre></div>

<hr>
<span id="Conclusion"></span><div class="header">
<p>
Previous: <a href="#Benchmark" accesskey="p" rel="prev">Benchmark</a>, Up: <a href="#Top" accesskey="u" rel="up">Top</a> &nbsp; </p>
</div>
<span id="Conclusion-1"></span><h2 class="chapter">20 Conclusion</h2>

<p>I expect you are pleasantly surprised by the speed of k9 and by the fact that it all fits in 134,152 bytes!  (For comparison the ls program weighs in at 51,888 bytes and can&rsquo;t even change directory.)
</p>
<p>If you&rsquo;re frustrated by the syntax or terse errors, then you&rsquo;re not alone.  Many have had the same problems, but persevered, and finally came away a power user able to squeeze information from data faster than previously imagined.
</p>
<p>Eventually, you&rsquo;ll realize that this manual isn&rsquo;t needed and it&rsquo;s all here...
</p>
<div class="format">
<pre class="verbatim">*ffi: a:&quot;./a.so&quot;5:`f!&quot;ii&quot;;a.f[2;3] / int f(int i,int j){return i+j;}
*k/c: b:&quot;./b.so&quot;5:`f!2   ;b.f[2;3] / K f(K x,K y){return ki(xi+yi);}
[python:   import k;k.k('+',2,3)]
[nodejs: require('k').k('+',2,3)]
limit: #(4billion) name8 code(param8 local8 global32 const128)

verb                   adverb                  noun
: x         y          f' each      g' each    char &quot; ab&quot;              \l a.k
+ flip      plus    [x]f/ over      c/ join    name ``ab               \t:n x
- minus     minus   [x]f\ scan      c\ splt    int  0N 2 3 0W          \u:n x
* first     times   [y]f':eachprior            flt  0n 2 3.4 0w        \v
%           divide     f/:eachright g/:over    date 2021.01.23   .z.d
&amp; where     min/and    f\:eachleft  g\:scan    time 12:34:56.789 .z.t
| reverse   max/or     
&lt; asc       less       i/o (*enterprise)       class                   \f
&gt; desc      more       0: r/w line             list l:(2;3.4;`c)       \fl x
= group     equal      1: r/w char             dict d:[n:`b;i:2]       \fc x   
~ not       match     *2: r/w data             func f:{[a;b]a+b}       \fs x
! key       key       *3: k-ipc set            expr e::a+b             \cd [d]
, enlist    cat       *4: https get
^ sort   [f]cut       *5: ffi/py/js/..         table t:[[]n:`b`c;i:2 3]
# count  [f]take                              utable u: [[n:`b`c]i:2 3]
_ floor  [f]drop                       
$ string    parse      $[b;t;f] cond
? unique [n]find                             
@ type   [n]at         @[x;i;f[;y]] amend
. value     dot        .[x;i;f[;y]] dmend

`js?`js d:[d:.z.d;t:.z.t;n:`ab;i:23;f:4.5];`csv?`csv t:2#,d
{select|update} A by B from T where C; delete from T where C
count first last min max sum dot avg var [dev med mode countd ..]
sqrt sqr exp log sin cos div mod bar in bin
\\ exit  /comment \trace [:return 'signal if do while]</pre></div>





<hr>



</body>
</html>
